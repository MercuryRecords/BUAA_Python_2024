import{_ as te}from"./Navigator.vue_vue_type_script_setup_true_lang-Ce9qsQIy.js";import{d as E,r as _,a as ne,q as se,s as re,A as S,E as s,b as n,o as M,c as N,e as i,f as e,w as a,u as z,y as q,h as V,T as ue,U as de,V as ie,W as pe,X as me,p as ce,m as _e,_ as A}from"./index-BKtHripP.js";const I=w=>(ce("data-v-2af91d9c"),w=w(),_e(),w),fe={class:"problem-set-container"},ve={class:"problem-set"},be={class:"header-content"},ge=I(()=>i("span",null,"新建题单",-1)),Ve={class:"filter-info"},we={class:"button-container"},he=I(()=>i("span",null,"Share",-1)),ye=I(()=>i("span",null,"Delete",-1)),Ce={class:"dialog-footer"},xe={class:"dialog-footer"},ke={class:"dialog-footer"},Ue=E({__name:"CreateSheet",props:["username"],setup(w){const y=_("practice"),h=_(1),v=_(20),f=_(0),b=w,g=ne([]),F=se(()=>{const t=(h.value-1)*v.value,l=t+v.value;return g.slice(t,l)}),C=_(!1),x=_(!1),k=_(!1),p=_({username:"",title:"",description:"",tag:[]}),r=_({username:"",problem_group_id:0,title:"",description:""}),u=_({username:"",problem_group_id:0,group_name:"",permission:0});re(()=>{P()});const P=async()=>{try{const t=await S.post("/get_problem_groups",{username:b.username,mode:1,filter_group:""},{headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(console.log(t.data),t.data.code===200){g.length=0;for(let l=0;l<t.data.data.length;l++)g.push(t.data.data[l]);f.value=t.data.data.length,f.value=t.data.total||t.data.data.length}}catch(t){console.error("获取题单列表失败:",t),s.error("获取题单列表失败，请重试")}},j=t=>{v.value=t,h.value=1},W=t=>{h.value=t},X=()=>{C.value=!0,p.value.username=b.username},H=async()=>{try{console.log(p.value);const t=await S.post("/problem_group_create",p.value,{headers:{"Content-Type":"application/x-www-form-urlencoded"}});t.data.code===200?(s.success("新题单创建成功"),C.value=!1,f.value++,g.length>=v.value&&(h.value=Math.ceil(f.value/v.value)),await P()):(console.log(t.data.code),s.error("题单创建失败"))}catch(t){console.error("题单创建失败:",t),s.error("题单创建失败，请重试")}},J=t=>{x.value=!0,r.value={username:b.username,problem_group_id:t.id,title:t.name,description:t.description||""}},K=async()=>{try{(await S.post("/problem_group_update",r.value,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})).data.code===200?(s.success("题单更新成功"),x.value=!1,P()):s.error("题单更新失败")}catch(t){console.error("题单更新失败:",t),s.error("题单更新失败，请重试")}},L=t=>{k.value=!0,u.value={username:b.username,problem_group_id:t.id,group_name:"",permission:0}},O=async()=>{try{(await S.post("/problem_share",u.value,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})).data.code===200?(s.success("题单分享成功"),k.value=!1):s.error("题单分享失败")}catch(t){console.error("题单分享失败:",t),s.error("题单分享失败，请重试")}},Q=async t=>{try{await ue.confirm("确定要删除这个题单吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await S.post("/problem_group_delete",{username:b.username,problem_group_id:t.id},{headers:{"Content-Type":"application/x-www-form-urlencoded"}})).data.code===200?(s.success("题单删除成功"),f.value--,await P()):s.error("题单删除失败")}catch(l){l!=="cancel"&&(console.error("题单删除失败:",l),s.error("题单删除失败，请重试"))}};return(t,l)=>{const R=n("el-tab-pane"),Y=n("el-tabs"),$=n("el-icon"),m=n("el-button"),Z=n("el-card"),U=n("el-table-column"),ee=n("router-link"),le=n("el-table"),ae=n("el-pagination"),c=n("el-input"),d=n("el-form-item"),D=n("el-form"),T=n("el-dialog"),G=n("el-option"),oe=n("el-select");return M(),N("div",fe,[i("div",ve,[e(Z,{class:"filter-card"},{default:a(()=>[i("div",be,[e(Y,{modelValue:y.value,"onUpdate:modelValue":l[0]||(l[0]=o=>y.value=o)},{default:a(()=>[e(R,{label:"练习题单",name:"practice"})]),_:1},8,["modelValue"]),e(m,{type:"primary",onClick:X},{default:a(()=>[e($,null,{default:a(()=>[e(z(de))]),_:1}),ge]),_:1})]),i("div",Ve,[i("span",null,"共计 "+q(f.value)+" 个题单",1)])]),_:1}),e(le,{data:F.value,style:{width:"100%"},"default-sort":{prop:"id",order:"ascending"}},{default:a(()=>[e(U,{prop:"id",label:"编号",width:"80",sortable:""}),e(U,{label:"名称",width:"300"},{default:a(o=>[e(ee,{to:{name:"sheet",query:{username:b.username,sheetId:o.row.id}},class:"problem-link"},{default:a(()=>[V(q(o.row.title),1)]),_:2},1032,["to"])]),_:1}),e(U,{prop:"creator",label:"创建者",width:"200"}),e(U,{prop:"problem_num",label:"题目数量",width:"250",sortable:""}),e(U,{label:"操作",width:"300"},{default:a(o=>[i("div",we,[e(m,{size:"small",onClick:B=>J(o.row)},{default:a(()=>[e($,null,{default:a(()=>[e(z(ie))]),_:1}),V(" Update ")]),_:2},1032,["onClick"]),e(m,{size:"small",onClick:B=>L(o.row)},{default:a(()=>[e($,null,{default:a(()=>[e(z(pe))]),_:1}),he]),_:2},1032,["onClick"]),e(m,{size:"small",type:"danger",onClick:B=>Q(o.row)},{default:a(()=>[e($,null,{default:a(()=>[e(z(me))]),_:1}),ye]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"]),e(ae,{class:"pages",onSizeChange:j,onCurrentChange:W,"current-page":h.value,"page-sizes":[20,50,100],"page-size":v.value,layout:"total, sizes, jumper, ->, prev, pager, next",total:f.value},null,8,["current-page","page-size","total"])]),e(T,{modelValue:C.value,"onUpdate:modelValue":l[5]||(l[5]=o=>C.value=o),title:"新建题单",width:"30%"},{footer:a(()=>[i("span",Ce,[e(m,{type:"primary",onClick:H},{default:a(()=>[V("确定")]),_:1}),e(m,{onClick:l[4]||(l[4]=o=>C.value=!1)},{default:a(()=>[V("取消")]),_:1})])]),default:a(()=>[e(D,{model:p.value,"label-width":"100px"},{default:a(()=>[e(d,{label:"用户名"},{default:a(()=>[e(c,{modelValue:p.value.username,"onUpdate:modelValue":l[1]||(l[1]=o=>p.value.username=o),disabled:""},null,8,["modelValue"])]),_:1}),e(d,{label:"题单标题"},{default:a(()=>[e(c,{modelValue:p.value.title,"onUpdate:modelValue":l[2]||(l[2]=o=>p.value.title=o)},null,8,["modelValue"])]),_:1}),e(d,{label:"题单描述"},{default:a(()=>[e(c,{modelValue:p.value.description,"onUpdate:modelValue":l[3]||(l[3]=o=>p.value.description=o),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(T,{modelValue:x.value,"onUpdate:modelValue":l[11]||(l[11]=o=>x.value=o),title:"更新题单",width:"30%"},{footer:a(()=>[i("span",xe,[e(m,{type:"primary",onClick:K},{default:a(()=>[V("确定")]),_:1}),e(m,{onClick:l[10]||(l[10]=o=>x.value=!1)},{default:a(()=>[V("取消")]),_:1})])]),default:a(()=>[e(D,{model:r.value,"label-width":"100px"},{default:a(()=>[e(d,{label:"用户名"},{default:a(()=>[e(c,{modelValue:r.value.username,"onUpdate:modelValue":l[6]||(l[6]=o=>r.value.username=o),disabled:""},null,8,["modelValue"])]),_:1}),e(d,{label:"题单ID"},{default:a(()=>[e(c,{modelValue:r.value.problem_group_id,"onUpdate:modelValue":l[7]||(l[7]=o=>r.value.problem_group_id=o),disabled:""},null,8,["modelValue"])]),_:1}),e(d,{label:"题单标题"},{default:a(()=>[e(c,{modelValue:r.value.title,"onUpdate:modelValue":l[8]||(l[8]=o=>r.value.title=o)},null,8,["modelValue"])]),_:1}),e(d,{label:"题单描述"},{default:a(()=>[e(c,{modelValue:r.value.description,"onUpdate:modelValue":l[9]||(l[9]=o=>r.value.description=o),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(T,{modelValue:k.value,"onUpdate:modelValue":l[17]||(l[17]=o=>k.value=o),title:"分享题单",width:"40%"},{footer:a(()=>[i("span",ke,[e(m,{type:"primary",onClick:O},{default:a(()=>[V("分享")]),_:1}),e(m,{onClick:l[16]||(l[16]=o=>k.value=!1)},{default:a(()=>[V("取消")]),_:1})])]),default:a(()=>[e(D,{model:u.value,"label-width":"100px"},{default:a(()=>[e(d,{label:"用户名"},{default:a(()=>[e(c,{modelValue:u.value.username,"onUpdate:modelValue":l[12]||(l[12]=o=>u.value.username=o),disabled:""},null,8,["modelValue"])]),_:1}),e(d,{label:"题单ID"},{default:a(()=>[e(c,{modelValue:u.value.problem_group_id,"onUpdate:modelValue":l[13]||(l[13]=o=>u.value.problem_group_id=o),disabled:""},null,8,["modelValue"])]),_:1}),e(d,{label:"分享目标群组"},{default:a(()=>[e(c,{modelValue:u.value.group_name,"onUpdate:modelValue":l[14]||(l[14]=o=>u.value.group_name=o),placeholder:"如果想分享给所有人，请不要输入任何字符"},null,8,["modelValue"])]),_:1}),e(d,{label:"权限"},{default:a(()=>[e(oe,{modelValue:u.value.permission,"onUpdate:modelValue":l[15]||(l[15]=o=>u.value.permission=o)},{default:a(()=>[e(G,{value:0,label:"仅查看"}),e(G,{value:1,label:"可查看并修改"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Se=A(Ue,[["__scopeId","data-v-2af91d9c"]]),Pe={class:"common-layout"},$e=E({__name:"SheetCreated",setup(w){return(y,h)=>{const v=n("el-header"),f=n("el-aside"),b=n("el-main"),g=n("el-container");return M(),N("div",Pe,[e(g,null,{default:a(()=>[e(v),e(g,null,{default:a(()=>[e(f,{width:"200px"},{default:a(()=>[e(te,{username:y.$route.query.username},null,8,["username"])]),_:1}),e(g,null,{default:a(()=>[e(b,{class:"shifted-content"},{default:a(()=>[e(Se,{username:y.$route.query.username},null,8,["username"])]),_:1})]),_:1})]),_:1})]),_:1})])}}}),Te=A($e,[["__scopeId","data-v-21a1acd0"]]);export{Te as default};
