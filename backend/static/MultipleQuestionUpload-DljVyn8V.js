import{_ as W}from"./Navigator.vue_vue_type_script_setup_true_lang-Ce9qsQIy.js";import{d as B,r as h,a as X,a2 as Z,b as c,o as g,c as C,e as u,f as l,w as o,h as r,g as U,n as ee,y as R,F as A,x as M,A as x,E as _,Y as le,i as te,p as oe,m as ae,_ as E}from"./index-BKtHripP.js";/* empty css                                                                       */const $=v=>(oe("data-v-78d7386f"),v=v(),ae(),v),ne={class:"upload-problem-container"},se={class:"panels-container"},de={class:"panel left-panel"},ue=$(()=>u("div",{class:"panel-header"},[u("h2",null,"OCR识别结果")],-1)),ce={class:"upload-button-container"},re=$(()=>u("div",{class:"el-upload__tip"}," 支持jpg/png/pdf文件，大小不超过5MB ",-1)),ie={class:"panel right-panel"},pe=$(()=>u("div",{class:"panel-header"},[u("h2",null,"题目信息")],-1)),_e={class:"answer-count-controls"},me={class:"tags-container"},fe={class:"dialog-footer"},he={class:"submit-buttons"},ge=B({__name:"MultipleUploadQuestion",props:["username","sheetId"],setup(v){h([]);const e=X({username:"",title:"",problem_group_id:0,type:"",content:"",ans_count:1,answer:"",field1:"",field2:"",field3:"",field4:"",field5:"",field6:"",field7:"",tags:[],answers:[""]}),w=h(""),i=h([]),b=h(0),f=h(!1),p=h(""),k=h(null),y=v,F=async d=>{const{file:t}=d,a=new FormData;a.append("username",y.username),a.append("file",t);try{const n=await x.post("/ocr",a,{headers:{"Content-Type":"multipart/form-data"}});console.log(n.data.code),console.log(n.data),w.value=n.data.text,i.value=n.data.questions||[],i.value.length>0&&I(i.value[0]),_.success("文件上传成功，OCR识别结果已更新")}catch(n){console.error("上传失败:",n),_.error("文件上传失败，请重试")}},I=d=>{e.tags.length=0,e.content=d.content,e.ans_count=d.choices.length,e.answers=d.choices.map(t=>t.split(" ").slice(1).join(" ")),e.type="c",d.choices.forEach((t,a)=>{const n=`field${a+1}`;e[n]=t,console.log(n),console.log(e[n])})},N=()=>{T(!1)},Q=d=>{e.tags=e.tags.filter(t=>t!==d)},S=()=>{f.value=!0,le(()=>{k.value&&k.value.focus()})},D=()=>{p.value&&e.tags.push(p.value),f.value=!1,p.value=""},q=()=>{e.ans_count=1,e.answer="",e.answers=[""]},O=()=>{e.ans_count<7&&(e.ans_count++,e.answers.push(""))},P=()=>{e.ans_count>1&&(e.ans_count--,e.answers.pop())},T=(d=!0)=>{const t={username:y.username,title:e.title,problem_group_id:y.sheetId,type:e.type,content:e.content,ans_count:e.ans_count,answer:e.answer,field1:e.field1,field2:e.field2,field3:e.field3,field4:e.field4,field5:e.field5,field6:e.field6,field7:e.field7,tags:e.tags};console.log(t),x.post("/problem_create",t,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(a=>{a.data.code===200?(console.log("提交成功:",a.data),_.success("题目提交成功"),d?setTimeout(()=>{te.back()},1e3):(b.value++,b.value<i.value.length?I(i.value[b.value]):_.info("所有题目已提交完毕"))):(console.log("提交失败:",a.data),_.error("题目提交失败"))}).catch(a=>{console.error("提交失败:",a),_.error("题目提交失败，请重试")})},j=async()=>{try{console.log(y.username),console.log(e.content);const d=await x.post("/extract_keywords",{username:y.username,text:e.content},{headers:{"Content-Type":"application/x-www-form-urlencoded"}});d.data.code===200?(d.data.keywords.forEach(a=>{e.tags.includes(a)||e.tags.push(a)}),_.success("已添加推荐标签")):_.warning("获取推荐标签失败")}catch(d){console.error("获取推荐标签出错:",d),_.error("获取推荐标签失败，请重试")}};return Z(w,d=>{d&&i.value.length>0&&I(i.value[0])}),(d,t)=>{const a=c("el-input"),n=c("el-button"),z=c("el-upload"),m=c("el-form-item"),L=c("el-option"),Y=c("el-select"),G=c("el-tag"),H=c("el-dialog"),J=c("el-form");return g(),C("div",ne,[u("div",se,[u("div",de,[ue,l(a,{type:"textarea",modelValue:w.value,"onUpdate:modelValue":t[0]||(t[0]=s=>w.value=s),rows:32,class:"ocr-textarea",placeholder:"OCR识别结果将显示在这里，处理会有点慢，请耐心等候~"},null,8,["modelValue"]),u("div",ce,[l(z,{class:"upload-demo",action:"#","http-request":F,"show-file-list":!1},{default:o(()=>[l(n,{type:"primary"},{default:o(()=>[r("上传题目文件")]),_:1})]),_:1})]),re]),u("div",ie,[pe,l(J,{model:e,"label-position":"left","label-width":"120px"},{default:o(()=>[l(m,{label:"题目名称"},{default:o(()=>[l(a,{modelValue:e.title,"onUpdate:modelValue":t[1]||(t[1]=s=>e.title=s),placeholder:"请输入题目名称"},null,8,["modelValue"])]),_:1}),l(m,{label:"题目类型"},{default:o(()=>[l(Y,{modelValue:e.type,"onUpdate:modelValue":t[2]||(t[2]=s=>e.type=s),placeholder:"请选择题目类型",onChange:q},{default:o(()=>[l(L,{label:"选择题",value:"c"})]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"题目内容"},{default:o(()=>[l(a,{type:"textarea",modelValue:e.content,"onUpdate:modelValue":t[3]||(t[3]=s=>e.content=s),rows:6,placeholder:"请输入题目内容"},null,8,["modelValue"])]),_:1}),e.type==="c"?(g(),U(m,{key:0,label:"正确答案"},{default:o(()=>[l(a,{modelValue:e.answer,"onUpdate:modelValue":t[4]||(t[4]=s=>e.answer=s),placeholder:"请输入正确答案（如：A）"},null,8,["modelValue"])]),_:1})):ee("",!0),l(m,{label:e.type==="c"?"选项数量":"答案数量"},{default:o(()=>[u("div",_e,[l(n,{onClick:P,disabled:e.ans_count<=1},{default:o(()=>[r("-")]),_:1},8,["disabled"]),u("span",null,R(e.ans_count),1),l(n,{onClick:O,disabled:e.ans_count>=7},{default:o(()=>[r("+")]),_:1},8,["disabled"])])]),_:1},8,["label"]),(g(!0),C(A,null,M(e.answers,(s,V)=>(g(),U(m,{key:V,label:`选项${String.fromCharCode(65+V)}`},{default:o(()=>[l(a,{modelValue:e[`field${V+1}`],"onUpdate:modelValue":K=>e[`field${V+1}`]=K},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128)),l(m,{label:"题目标签"},{default:o(()=>[u("div",me,[(g(!0),C(A,null,M(e.tags,s=>(g(),U(G,{key:s,closable:"",onClose:V=>Q(s)},{default:o(()=>[r(R(s),1)]),_:2},1032,["onClose"]))),128)),l(n,{class:"button-new-tag",size:"small",onClick:S},{default:o(()=>[r(" + 新标签 ")]),_:1}),l(n,{class:"button-new-tag",size:"small",onClick:j,type:"danger"},{default:o(()=>[r(" 推荐标签 ")]),_:1})])]),_:1}),l(H,{modelValue:f.value,"onUpdate:modelValue":t[7]||(t[7]=s=>f.value=s),title:"添加新标签",width:"30%"},{footer:o(()=>[u("span",fe,[l(n,{type:"primary",onClick:D},{default:o(()=>[r(" 确定 ")]),_:1}),l(n,{onClick:t[6]||(t[6]=s=>f.value=!1)},{default:o(()=>[r("取消")]),_:1})])]),default:o(()=>[l(a,{modelValue:p.value,"onUpdate:modelValue":t[5]||(t[5]=s=>p.value=s),ref_key:"inputRef",ref:k,placeholder:"请输入标签名称"},null,8,["modelValue"])]),_:1},8,["modelValue"]),l(m,null,{default:o(()=>[u("div",he,[l(n,{type:"primary",onClick:T},{default:o(()=>[r("提交题目(结束本次上传并返回题单界面)")]),_:1}),l(n,{type:"success",onClick:N},{default:o(()=>[r("提交并继续(继续上传，不会返回)")]),_:1})])]),_:1})]),_:1},8,["model"])])])])}}}),ve=E(ge,[["__scopeId","data-v-78d7386f"]]),we={class:"common-layout"},be=B({__name:"MultipleQuestionUpload",setup(v){return(e,w)=>{const i=c("el-header"),b=c("el-aside"),f=c("el-main"),p=c("el-container");return g(),C("div",we,[l(p,null,{default:o(()=>[l(i),l(p,{class:"main-container"},{default:o(()=>[l(b,{width:"200px",class:"navigation-aside"},{default:o(()=>[l(W,{username:e.$route.query.username},null,8,["username"])]),_:1}),l(p,null,{default:o(()=>[l(f,{class:"shifted-content"},{default:o(()=>[l(ve,{username:e.$route.query.username,sheetId:e.$route.query.sheetId},null,8,["username","sheetId"])]),_:1})]),_:1})]),_:1})]),_:1})])}}}),ke=E(be,[["__scopeId","data-v-dfca2b7c"]]);export{ke as default};
