import{d as we,a as D,r as p,q as N,s as ve,b as n,o as _,c as h,f as a,w as o,e as A,t as be,h as r,S as ke,u as Ce,F as T,x as q,n as xe,y as V,z as Te,A as C,E as m,i as z,T as qe,Z as Ve,g as I,_ as ze}from"./index-BKtHripP.js";import{_ as Ie}from"./Navigator.vue_vue_type_script_setup_true_lang-Ce9qsQIy.js";const Se={class:"common-layout"},$e={class:"problem-list"},Be={key:0,style:{"margin-top":"10px"}},Pe={class:"dialog-footer"},Ue=we({__name:"Sheet",setup(Ee){const c=Te(),l=D({keyword:"",tags:[],selectedTags:[]}),y=p([]),w=p(1),x=p(20),v=p(!1),S=p([]),E=p([]);async function G(){try{const e=await C.post("/get_user_tags",{username:c.query.username},{headers:{"Content-Type":"application/x-www-form-urlencoded"}});e.data.code===200?(S.value=e.data.data.filter(t=>!["选择题","选择","填空题","填空"].includes(t)),E.value=[{name:"所有标签",tags:S.value},{name:"题目类型",tags:["选择题","填空题"]}],console.log("Get the tags",S.value)):m.error(e.data.message)}catch(e){console.error("Error fetching user tags:",e),m.error("获取标签失败")}}const $=p([]),B=N(()=>{const e=(w.value-1)*x.value,t=e+x.value;return $.value.slice(e,t)}),F=N(()=>$.value.length),g=()=>{$.value=y.value.filter(e=>{const t=l.keyword===""||e.problem_title.includes(l.keyword)||e.id===parseInt(l.keyword)||e.creator.includes(l.keyword)||e.problem_group_title.includes(l.keyword)||e.content.includes(l.keyword),u=l.selectedTags.length===0||l.selectedTags.every(b=>e.tags.includes(b));return t&&u}),w.value=1,m.success(`找到 ${F.value} 个匹配的题目`)},K=e=>{x.value=e,w.value=1},j=e=>{w.value=e},R=(e,t)=>{m.success(`准备解决题目: ${e.problem_title}`);const u=B.value,b=u.findIndex(i=>i.id===e.id);console.log(t),console.log(u),z.push({name:"solve",query:{username:c.query.username,index:b,problem_group_id:t}})},L=e=>{const t=B.value.map(u=>u.id);console.log(t),C.post("/temporary_problem_group_create",{username:c.query.username,problem_ids:t},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(u){u.data.code===200?(console.log("Ready to solve"),R(e,u.data.data)):m.error(u.data.message)}).catch(function(){console.log("error submit!")})},Q=()=>{l.keyword="",l.tags=[],l.selectedTags=[],g()},Z=()=>{v.value=!0},H=()=>{v.value=!1,l.selectedTags=[...l.tags],g()},J=e=>{l.selectedTags=l.selectedTags.filter(t=>t!==e),l.tags=l.tags.filter(t=>t!==e),g()},O=e=>e>=.7?"success":e<.3?"danger":"warning";function W(){C.post("/get_problem_group_content",{username:c.query.username,problem_group_id:c.query.sheetId,is_temporary:"n",number_per_page:10},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){if(e.data.code===200){for(let t=0;t<e.data.data.length;t++)console.log(e.data.data[t]),y.value[t]=e.data.data[t],y.value[t].accuracy=e.data.data[t].all_count==0?0:e.data.data[t].all_right_count/e.data.data[t].all_count,console.log(y);g()}else m.error(e.data.message)}).catch(function(){console.log("error submit!")})}const X=async()=>{W()},Y=D([]),ee=async()=>{C.post("/group_get_groups",{username:c.query.username},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){if(e.data.code===200)for(let t=0;t<e.data.groups.length;t++)Y.push(e.data.groups[t].name);else m.error(e.data.message)}).catch(function(){console.log("error submit!")})};p("");const te=()=>{z.push({name:"upload",query:{username:c.query.username,sheetId:c.query.sheetId}})},ae=()=>{z.push({name:"multiple-upload",query:{username:c.query.username,sheetId:c.query.sheetId}})},oe=async e=>{await qe.confirm("确定要删除这个题目吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),C.post("/problem_delete",{username:c.query.username,problem_id:e.id},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){t.data.code===200?(m.success("删除成功"),y.value=y.value.filter(u=>u.id!==e.id),g()):m.error(t.data.message||"删除失败")}).catch(function(){m.error("删除请求失败")})},le=e=>{z.push({name:"questionUpdate",query:{username:c.query.username,problem_id:e.id,sheetId:c.query.sheetId}})};return ve(async()=>{await G(),await X(),await ee()}),(e,t)=>{const u=n("el-header"),b=n("el-aside"),i=n("el-button"),k=n("el-form-item"),ne=n("el-input"),se=n("el-icon"),M=n("el-dropdown-item"),re=n("el-dropdown-menu"),ue=n("el-dropdown"),ce=n("el-form"),P=n("el-tag"),de=n("el-card"),f=n("el-table-column"),ie=n("el-table"),_e=n("el-pagination"),me=n("el-main"),U=n("el-container"),pe=n("el-checkbox"),ge=n("el-checkbox-group"),fe=n("el-tab-pane"),ye=n("el-tabs"),he=n("el-dialog");return _(),h("div",Se,[a(U,null,{default:o(()=>[a(u),a(U,null,{default:o(()=>[a(b,{width:"200px"},{default:o(()=>[a(Ie,{username:e.$route.query.username},null,8,["username"])]),_:1}),a(U,null,{default:o(()=>[a(me,{class:"shifted-content"},{default:o(()=>[A("div",$e,[a(de,null,{default:o(()=>[a(ce,{inline:!0,model:l,class:"demo-form-inline",onSubmit:t[1]||(t[1]=be(()=>{},["prevent"]))},{default:o(()=>[a(k,null,{default:o(()=>[a(i,{onClick:Z},{default:o(()=>[r("选择标签")]),_:1})]),_:1}),a(k,null,{default:o(()=>[a(i,{type:"primary",onClick:Q},{default:o(()=>[r("清除所有筛选条件")]),_:1})]),_:1}),a(k,null,{default:o(()=>[a(k,null,{default:o(()=>[a(ne,{modelValue:l.keyword,"onUpdate:modelValue":t[0]||(t[0]=s=>l.keyword=s),placeholder:"搜索关键词（题号、标题、上传者、所属题单）",style:{width:"310px","margin-left":"80px"},onKeyup:ke(g,["enter"])},null,8,["modelValue"])]),_:1}),a(k,null,{default:o(()=>[a(i,{onClick:g},{default:o(()=>[r("搜索")]),_:1})]),_:1})]),_:1}),a(ue,null,{dropdown:o(()=>[a(re,null,{default:o(()=>[a(M,{onClick:te},{default:o(()=>[r("上传单道题目")]),_:1}),a(M,{onClick:ae},{default:o(()=>[r("上传多道题目(只支持选择题)")]),_:1})]),_:1})]),default:o(()=>[a(i,{type:"primary"},{default:o(()=>[r(" 新增题目 "),a(se,{class:"el-icon--right"},{default:o(()=>[a(Ce(Ve))]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),l.selectedTags.length>0?(_(),h("div",Be,[(_(!0),h(T,null,q(l.selectedTags,s=>(_(),I(P,{key:s,closable:"",onClose:d=>J(s),style:{"margin-right":"5px"}},{default:o(()=>[r(V(s),1)]),_:2},1032,["onClose"]))),128))])):xe("",!0)]),_:1}),a(ie,{data:B.value,style:{width:"100%"}},{default:o(()=>[a(f,{prop:"id",label:"题号",width:"100"}),a(f,{prop:"problem_title",label:"题目名称"}),a(f,{prop:"creator",label:"上传者",width:"100"}),a(f,{prop:"problem_group_title",label:"所属题单",width:"180"}),a(f,{label:"标签",width:"200"},{default:o(s=>[(_(!0),h(T,null,q(s.row.tags,d=>(_(),I(P,{key:d,size:"small",style:{"margin-right":"5px"}},{default:o(()=>[r(V(d),1)]),_:2},1024))),128))]),_:1}),a(f,{prop:"accuracy",label:"正确率",width:"100"},{default:o(s=>[a(P,{type:O(s.row.accuracy),size:"small"},{default:o(()=>[r(V((s.row.accuracy*100).toFixed(2))+"% ",1)]),_:2},1032,["type"])]),_:1}),a(f,{label:"操作",width:"280"},{default:o(s=>[a(i,{type:"text",size:"small",onClick:d=>L(s.row)},{default:o(()=>[r("解题")]),_:2},1032,["onClick"]),a(i,{type:"text",size:"small",onClick:d=>le(s.row)},{default:o(()=>[r("更新")]),_:2},1032,["onClick"]),a(i,{type:"text",size:"small",onClick:d=>oe(s.row)},{default:o(()=>[r("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),a(_e,{class:"pages",onSizeChange:K,onCurrentChange:j,"current-page":w.value,"page-sizes":[10,20,50,100],"page-size":x.value,layout:"total, sizes, prev, pager, next, jumper",total:F.value},null,8,["current-page","page-size","total"])])]),_:1})]),_:1})]),_:1})]),_:1}),a(he,{modelValue:v.value,"onUpdate:modelValue":t[4]||(t[4]=s=>v.value=s),title:"选择标签",width:"50%"},{footer:o(()=>[A("span",Pe,[a(i,{onClick:t[3]||(t[3]=s=>v.value=!1)},{default:o(()=>[r("取消")]),_:1}),a(i,{type:"primary",onClick:H},{default:o(()=>[r("确认")]),_:1})])]),default:o(()=>[a(ye,{type:"border-card"},{default:o(()=>[(_(!0),h(T,null,q(E.value,s=>(_(),I(fe,{key:s.name,label:s.name},{default:o(()=>[a(ge,{modelValue:l.tags,"onUpdate:modelValue":t[2]||(t[2]=d=>l.tags=d)},{default:o(()=>[(_(!0),h(T,null,q(s.tags,d=>(_(),I(pe,{key:d,label:d},{default:o(()=>[r(V(d),1)]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1},8,["modelValue"])])}}}),De=ze(Ue,[["__scopeId","data-v-854cfe36"]]);export{De as default};
