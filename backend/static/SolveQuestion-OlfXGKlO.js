import{d as M,r as _,s as P,b as S,o,c as r,e as a,F as x,x as D,f as p,w,h as g,A as V,E as v,y as d,g as L,n as A,p as Y,m as j,_ as H,q as G,$ as oe,R as N,z as ne}from"./index-BKtHripP.js";import{_ as re}from"./Navigator.vue_vue_type_script_setup_true_lang-Ce9qsQIy.js";const ue=b=>(Y("data-v-c27f8770"),b=b(),j(),b),ce=ue(()=>a("h3",null,"讨论区",-1)),ie={class:"comment-section"},de={key:0,class:"comment-list"},_e={class:"comment-header"},ve=["src"],pe={class:"user-info"},me={class:"username"},he={class:"content"},fe={class:"comment-footer"},ye={class:"timestamp"},we={key:0,class:"reply-form"},ge={key:1,class:"replies"},ke={class:"reply-header"},be=["src"],Ce={class:"user-info"},$e={class:"username"},Ae={class:"content"},qe={class:"reply-footer"},Se={class:"timestamp"},Te={key:1},Ie={class:"add-comment"},Ve=M({__name:"CommentSection",props:["username","questionId"],setup(b){const m=b,T=_([]),k=_(""),h=_(null),C=_(""),t=async(u,e)=>{try{const c=await V.post("/comment_get_comments_from_id",{username:m.username,parent_id:u,is_sub_comment:e},{headers:{"Content-Type":"application/x-www-form-urlencoded"}});return c.data.code===200?Promise.all(c.data.data.map(async y=>{const l=await F(y.user.username);return{...y,avatar:l}})):(v.error(c.data.message),[])}catch{v.error("获取回复失败")}},$=async(u,e)=>{try{const c=await V.post("/comment_get_comments_from_id",{username:m.username,parent_id:u,is_sub_comment:e},{headers:{"Content-Type":"application/x-www-form-urlencoded"}});c.data.code===200?T.value=await Promise.all(c.data.data.map(async y=>{const l=await F(y.user.username),f=await t(y.id,"y");return{...y,avatar:l,replies:f,showReplies:!1}})):v.error(c.data.message)}catch{v.error("获取评论失败")}},F=async u=>{try{const e=await V.post("/get_avatar",{username:u},{headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(e.data.code===200)return e.data.avatar}catch(e){console.error("获取头像失败",e)}return""},R=async()=>{if(!k.value.trim()){v.warning("评论内容不能为空");return}try{const u=await V.post("/comment_add",{username:m.username,parent_id:m.questionId,content:k.value,is_sub_comment:"n"},{headers:{"Content-Type":"application/x-www-form-urlencoded"}});u.data.code===200?(v.success("评论发表成功"),k.value="",await $(m.questionId,"n")):v.error(u.data.message)}catch{v.error("评论发表失败")}},n=u=>{h.value=u,C.value=""},Q=async u=>{if(!C.value.trim()){v.warning("回复内容不能为空");return}try{const e=await V.post("/comment_add",{username:m.username,parent_id:u,content:C.value,is_sub_comment:"y"},{headers:{"Content-Type":"application/x-www-form-urlencoded"}});e.data.code===200?(v.success("回复发表成功"),C.value="",h.value=null,await $(m.questionId,"n")):v.error(e.data.message)}catch{v.error("回复发表失败")}},B=u=>{const e=T.value.find(c=>c.id===u);e&&(e.showReplies=!e.showReplies)},I=u=>{const e=new Date(u),c=e.getFullYear(),y=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return`${c}年${y}月${l}日`};return P(()=>{$(m.questionId,"n")}),(u,e)=>{const c=S("el-button"),y=S("el-input");return o(),r(x,null,[ce,a("div",ie,[T.value.length>0?(o(),r("div",de,[(o(!0),r(x,null,D(T.value,l=>(o(),r("div",{key:l.id,class:"comment"},[a("div",_e,[a("img",{src:l.avatar,class:"avatar",alt:"User Avatar"},null,8,ve),a("div",pe,[a("span",me,d(l.user.username),1),a("span",he,d(l.content),1)])]),a("div",fe,[a("span",ye,d(I(l.create_time)),1),p(c,{onClick:f=>n(l.id),size:"small"},{default:w(()=>[g("回复")]),_:2},1032,["onClick"]),l.replies&&l.replies.length>0?(o(),L(c,{key:0,onClick:f=>B(l.id),size:"small"},{default:w(()=>[g(d(l.showReplies?"收起回复":`展开回复 (${l.replies.length})`),1)]),_:2},1032,["onClick"])):A("",!0)]),h.value===l.id?(o(),r("div",we,[p(y,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=f=>C.value=f),type:"textarea",rows:2,placeholder:"请输入您的回复"},null,8,["modelValue"]),p(c,{onClick:f=>Q(l.id),type:"primary",size:"small",class:"submit_reply"},{default:w(()=>[g("提交回复")]),_:2},1032,["onClick"])])):A("",!0),l.showReplies&&l.replies&&l.replies.length>0?(o(),r("div",ge,[(o(!0),r(x,null,D(l.replies,f=>(o(),r("div",{key:f.id,class:"reply"},[a("div",ke,[a("img",{src:f.avatar,class:"avatar small",alt:"User Avatar"},null,8,be),a("div",Ce,[a("span",$e,d(f.user.username),1),a("span",Ae,d(f.content),1)])]),a("div",qe,[a("span",Se,d(I(f.create_time)),1)])]))),128))])):A("",!0)]))),128))])):(o(),r("div",Te,"暂无评论")),a("div",Ie,[p(y,{modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=l=>k.value=l),type:"textarea",rows:3,placeholder:"请输入您的评论"},null,8,["modelValue"]),p(c,{onClick:R,type:"primary"},{default:w(()=>[g("发表评论")]),_:1})])])],64)}}}),xe=H(Ve,[["__scopeId","data-v-c27f8770"]]),J=b=>(Y("data-v-4878ca6d"),b=b(),j(),b),Fe={class:"do-question"},Re={class:"content-wrapper"},Be={key:0,class:"question-container"},De={class:"question-title"},Qe={key:0,class:"options"},Ee=["onClick"],ze={class:"option-label"},Ue={key:1,class:"fill-in-blank"},Ge={class:"navigation"},Ne={key:2,class:"result-and-comments"},Me={class:"result-container"},Pe=J(()=>a("h3",null,"做题统计",-1)),Le={class:"stat-line"},Ye={class:"red"},je={class:"stat-line"},He={class:"progress-bar"},Je={class:"percentage"},Ke={key:0,class:"correct-answers"},Oe=J(()=>a("h3",null,"正确答案：",-1)),We={key:0},Xe={key:1},Ze={class:"result-container"},et={class:"question-selector"},tt={class:"question-item"},at={class:"question-title-menu"},st=M({__name:"SolveQuestion",setup(b){const m=ne(),T=_(m.query.username||"测试用户"),k=_([]),h=_(parseInt(m.query.index,10)||0),C=G(()=>k.value.length),t=G(()=>k.value[h.value]),$=_(""),F=_([]),R=_([]),n=_(""),Q=_(""),B=_(!1),I=_(!1),u=_(!1),e=_(!1);G(()=>t.value?t.value.user_count==0?0:t.value.user_right_count/t.value.user_count:0);const c=G(()=>t.value?t.value.all_count==0?0:t.value.all_right_count/t.value.all_count:0),y=s=>{e.value||(n.value=["A","B","C","D","E","F","G"][s])},l=()=>{V.post("/problem_check",{username:m.query.username,problem_id:t.value.id,user_answer:n.value,user_field1:Array.isArray(n.value)?n.value[0]:"",user_field2:Array.isArray(n.value)?n.value[1]:"",user_field3:Array.isArray(n.value)?n.value[2]:"",user_field4:Array.isArray(n.value)?n.value[3]:"",user_field5:Array.isArray(n.value)?n.value[4]:"",user_field6:Array.isArray(n.value)?n.value[5]:"",user_field7:Array.isArray(n.value)?n.value[6]:""},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(s){s.data.code===200?(B.value=s.data.data.correct=="T",t.value.user_right_count=s.data.data.user_right_count,t.value.user_count=s.data.data.user_count,t.value.all_count=s.data.data.all_count,t.value.all_right_count=s.data.data.all_right_count,t.value.type==="c"?$.value=s.data.data.answer:t.value.type==="b"&&(F.value=[s.data.data.field1,s.data.data.field2,s.data.data.field3,s.data.data.field4,s.data.data.field5,s.data.data.field6,s.data.data.field7],R.value=[s.data.data.correct1=="T",s.data.data.correct2=="T",s.data.data.correct3=="T",s.data.data.correct4=="T",s.data.data.correct5=="T",s.data.data.correct6=="T",s.data.data.correct7=="T"]),e.value=!0):v.error(s.data.message)}).catch(function(){console.log("error submit!")})},f=()=>{if(t.value.type==="c"){if(!n.value){v.warning("请先选择一个答案");return}}else if(t.value.type==="b"&&!n.value.every(s=>s)){v.warning("请填写所有空格");return}l()},K=()=>{h.value>0&&(h.value--,z())},O=()=>{h.value<C.value-1&&(h.value++,z())},z=()=>{n.value=t.value.type==="c"?"":Array(t.value.ans_count).fill(""),Q.value="",B.value=!1,$.value="",F.value=[],u.value=!1,e.value=!1,R.value=[]},W=s=>{h.value=parseInt(s),z(),I.value=!1},X=()=>{V.post("/get_problem_group_content",{username:m.query.username,problem_group_id:m.query.problem_group_id,is_temporary:"y"},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(s){s.data.code===200?(k.value=s.data.data,console.log(k.value),z()):v.error(s.data.message)}).catch(function(){console.log("error submit!")})},Z=()=>{u.value=!u.value};return P(()=>{X()}),(s,U)=>{const ee=S("el-input"),E=S("el-button"),te=S("el-menu-item"),ae=S("el-menu"),se=S("el-scrollbar"),le=S("el-drawer");return o(),r("div",Fe,[p(re,{username:T.value},null,8,["username"]),a("div",Re,[t.value?(o(),r("div",Be,[a("h2",null,"题目 "+d(h.value+1)+" / "+d(C.value),1),a("p",De,d(t.value.content),1),t.value.type==="c"?(o(),r("div",Qe,[(o(!0),r(x,null,D(t.value.ans_count,i=>(o(),r("div",{key:i,class:N(["option",{selected:!e.value&&n.value===["A","B","C","D","E","F","G"][i-1],correct:e.value&&$.value===["A","B","C","D","E","F","G"][i-1],incorrect:e.value&&n.value===["A","B","C","D","E","F","G"][i-1]&&n.value!==$.value}]),onClick:q=>y(i-1)},[a("span",ze,d(["A","B","C","D","E","F","G"][i-1])+".",1),g(" "+d(t.value[`field${i}`]),1)],10,Ee))),128))])):t.value.type==="b"?(o(),r("div",Ue,[(o(!0),r(x,null,D(t.value.ans_count,i=>(o(),r("div",{key:i,class:"fill-in-blank-item"},[p(ee,{modelValue:n.value[i-1],"onUpdate:modelValue":q=>n.value[i-1]=q,placeholder:`请输入第${i}空的答案`,class:N({"correct-input":e.value&&R.value[i-1],"incorrect-input":e.value&&!R.value[i-1]})},null,8,["modelValue","onUpdate:modelValue","placeholder","class"])]))),128))])):A("",!0),a("div",Ge,[p(E,{onClick:K,disabled:h.value===0},{default:w(()=>[g("上一题")]),_:1},8,["disabled"]),p(E,{onClick:f,type:"primary",disabled:e.value},{default:w(()=>[g("提交答案")]),_:1},8,["disabled"]),p(E,{onClick:O,disabled:h.value===C.value-1},{default:w(()=>[g("下一题")]),_:1},8,["disabled"])]),e.value?(o(),r("div",Ne,[a("div",Me,[Pe,a("p",Le,[g(" 本题你做过 "+d(t.value.user_count)+" 次，错了 ",1),a("span",Ye,d(t.value.user_count-t.value.user_right_count),1),g(" 次 ")]),a("div",je,[g(" 题库正确率： "),a("div",He,[a("div",{class:"progress",style:oe({width:`${(c.value*100).toFixed(2)}%`})},null,4)]),a("span",Je,d((c.value*100).toFixed(2))+"%",1)]),p(E,{onClick:Z,class:"show-answer-button"},{default:w(()=>[g(d(u.value?"隐藏答案":"显示答案"),1)]),_:1}),u.value?(o(),r("div",Ke,[Oe,t.value.type==="c"?(o(),r("p",We,d($.value),1)):t.value.type==="b"?(o(),r("div",Xe,[(o(!0),r(x,null,D(F.value.slice(0,t.value.ans_count),(i,q)=>(o(),r("p",{key:q}," 第"+d(q+1)+"空："+d(i),1))),128))])):A("",!0)])):A("",!0)]),a("div",Ze,[p(xe,{questionId:t.value.id,username:T.value},null,8,["questionId","username"])])])):A("",!0),Q.value?(o(),r("div",{key:3,class:N(["feedback",{"is-correct":B.value,"is-incorrect":!B.value}])},d(Q.value),3)):A("",!0)])):A("",!0),a("div",et,[p(E,{class:"selector-button",onClick:U[0]||(U[0]=i=>I.value=!0)},{default:w(()=>[g(" 选择题目 ")]),_:1})])]),p(le,{title:"题目列表",modelValue:I.value,"onUpdate:modelValue":U[1]||(U[1]=i=>I.value=i),direction:"rtl",size:"300px"},{default:w(()=>[p(se,{height:"calc(100vh - 60px)"},{default:w(()=>[p(ae,{"default-active":h.value.toString(),onSelect:W,class:"question-menu"},{default:w(()=>[(o(!0),r(x,null,D(k.value,(i,q)=>(o(),L(te,{key:q,index:q.toString(),class:"question-menu-item"},{default:w(()=>[a("span",tt,[a("span",at,d(i.problem_title),1)])]),_:2},1032,["index"]))),128))]),_:1},8,["default-active"])]),_:1})]),_:1},8,["modelValue"])])}}}),nt=H(st,[["__scopeId","data-v-4878ca6d"]]);export{nt as default};
