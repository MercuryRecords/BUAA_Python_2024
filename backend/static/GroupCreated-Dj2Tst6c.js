import{d as q,r as c,a as S,q as le,s as re,A as C,E as n,b as y,B as se,o as G,c as L,f as a,w as t,e as b,u as o,h as i,y as F,C as D,D as ne,g as de,G as _,H as I,I as U,J as h,K as ue,L as ie,M as ce,N as me,O as R,P as N,Q as pe,p as P,m as A,_ as O,R as fe}from"./index-BKtHripP.js";import{_ as _e}from"./Navigator.vue_vue_type_script_setup_true_lang-Ce9qsQIy.js";const ge=m=>(P("data-v-51acc01f"),m=m(),A(),m),ve={class:"group-management"},be={class:"card-header"},we=ge(()=>b("span",null,"我创建的群组",-1)),he={class:"dialog-footer"},ye={class:"dialog-footer"},Ce={class:"dialog-footer"},Ve=q({__name:"CreateGroup",props:["username"],setup(m){const d=m,g=c(!1),u=S({name:"",description:""});let p=c(!1),f=c(!1),V=c(!0),v=c(""),w=c("");const x=c([]),M=c({}),E=c(""),H=le(()=>x.value.filter(l=>!E.value||l.name.toLowerCase().includes(E.value.toLowerCase()))),z=c(),J=S({name:[{validator:(l,e,s)=>{e===""?s(new Error("请输入群组名称")):s()},trigger:"blur"}]}),B=()=>{u.name="",u.description=""};re(async()=>k());async function k(){try{const l=await C.post("/group_get_groups",{username:d.username},{headers:{"Content-Type":"application/x-www-form-urlencoded"}});l.data.code===200?(x.value=l.data.groups.filter(e=>e.creator===d.username),await Z()):n.error(l.data.message)}catch(l){console.error("Error fetching data:",l),n.error("Failed to fetch data")}}const K=async l=>{l&&await l.validate(async e=>{if(e){g.value=!1;try{const s=await C.post("/group_create",{username:d.username,group_name:u.name,group_description:u.description},{headers:{"Content-Type":"application/x-www-form-urlencoded"}});s.data.code===200?(n.success(s.data.message),await k(),B()):n.error(s.data.message)}catch(s){console.error("Error creating group:",s),n.error("Failed to create group")}}else console.log("submit error")})};function Q(){g.value=!0}function j(){g.value=!1,B()}function W(l){v.value=l.name,p.value=!0}async function X(l){try{const e=await C.post("/group_delete_all",{group_name:l.name,username:d.username},{headers:{"Content-Type":"application/x-www-form-urlencoded"}});e.data.code===200?(n.success(e.data.message),await k()):n.error(e.data.message)}catch(e){console.error("Error deleting group:",e),n.error("Failed to delete group")}}async function Y(l){try{const e=await C.post("/group_delete_member",{to_deleter:l.username,group_name:v.value,username:d.username},{headers:{"Content-Type":"application/x-www-form-urlencoded"}});e.data.code===200?(p.value=!1,n.success(e.data.message),await k()):n.error(e.data.message)}catch(e){console.error("Error deleting member:",e),n.error("Failed to delete member")}}async function Z(){for(const l of x.value)try{const e=await C.post("/group_get_members",{group_name:l.name,username:d.username},{headers:{"Content-Type":"application/x-www-form-urlencoded"}});e.data.code===200?M.value[l.name]=e.data.members.map(s=>({username:s})):n.error(e.data.message)}catch(e){console.error("Error fetching group members:",e),n.error("Failed to fetch group members")}V.value=!1}function ee(l){return M.value[l]||[]}function $(l){return l===d.username}function ae(l){w.value=l.description,v.value=l.name,f.value=!0}return(l,e)=>{const s=y("el-descriptions-item"),te=y("el-descriptions"),oe=se("loading");return G(),L("div",ve,[a(o(ce),{class:"group-card"},{header:t(()=>[b("div",be,[we,a(o(_),{type:"primary",onClick:Q},{default:t(()=>[i("新建群组")]),_:1})])]),default:t(()=>[a(o(I),{modelValue:E.value,"onUpdate:modelValue":e[0]||(e[0]=r=>E.value=r),placeholder:"搜索群组","prefix-icon":"el-icon-search",clearable:"",class:"search-input"},null,8,["modelValue"]),a(o(U),{data:H.value,style:{width:"100%"},class:"group-table"},{default:t(()=>[a(o(h),{label:"群组名称",prop:"name"}),a(o(h),{label:"创建者",prop:"creator"},{default:t(({row:r})=>[a(o(ue),{size:"small",type:r.creator===d.username?"success":"info"},{default:t(()=>[i(F(r.creator),1)]),_:2},1032,["type"])]),_:1}),a(o(h),{label:"人数",prop:"number",width:"80"}),a(o(h),{label:"操作",align:"center",width:"280"},{default:t(({row:r})=>[a(o(_),{type:"",size:"small",onClick:T=>ae(r)},{default:t(()=>[i(" 详情 ")]),_:2},1032,["onClick"]),a(o(_),{type:"",size:"small",onClick:T=>W(r)},{default:t(()=>[i(" 管理群组 ")]),_:2},1032,["onClick"]),a(o(ie),{title:"确定要删除该群组吗？",onConfirm:T=>X(r)},{reference:t(()=>[a(o(_),{type:"danger",size:"small"},{default:t(()=>[i(" 删除群组 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])]),_:1}),a(o(N),{modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=r=>g.value=r),title:"新建群组",width:"30%"},{footer:t(()=>[b("span",he,[a(o(_),{onClick:j},{default:t(()=>[i("取 消")]),_:1}),a(o(_),{type:"primary",onClick:e[3]||(e[3]=r=>K(z.value))},{default:t(()=>[i("确 定")]),_:1})])]),default:t(()=>[a(o(me),{model:u,"label-width":"80px",rules:J,ref_key:"ruleFormRef",ref:z},{default:t(()=>[a(o(R),{label:"群组名称",prop:"name"},{default:t(()=>[a(o(I),{modelValue:u.name,"onUpdate:modelValue":e[1]||(e[1]=r=>u.name=r),autocomplete:"off",clearable:""},null,8,["modelValue"])]),_:1}),a(o(R),{label:"描述"},{default:t(()=>[a(o(I),{modelValue:u.description,"onUpdate:modelValue":e[2]||(e[2]=r=>u.description=r),type:"textarea",rows:3,placeholder:"请输入群组描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),a(o(N),{modelValue:o(f),"onUpdate:modelValue":e[6]||(e[6]=r=>D(f)?f.value=r:f=r),title:"群组详情",width:"30%","align-center":""},{footer:t(()=>[b("div",ye,[a(o(_),{onClick:e[5]||(e[5]=r=>D(f)?f.value=!1:f=!1)},{default:t(()=>[i("关闭")]),_:1})])]),default:t(()=>[a(te,{column:1,border:""},{default:t(()=>[a(s,{label:"群组名称"},{default:t(()=>[i(F(o(v)),1)]),_:1}),a(s,{label:"描述"},{default:t(()=>[i(F(o(w)),1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(o(N),{modelValue:o(p),"onUpdate:modelValue":e[8]||(e[8]=r=>D(p)?p.value=r:p=r),title:"群组成员管理",width:"50%"},{footer:t(()=>[b("span",Ce,[a(o(_),{onClick:e[7]||(e[7]=r=>D(p)?p.value=!1:p=!1)},{default:t(()=>[i("关闭")]),_:1})])]),default:t(()=>[ne((G(),de(o(U),{data:ee(o(v))},{default:t(()=>[a(o(h),{prop:"username",label:"名称"}),a(o(h),{label:"操作",width:"120",align:"center"},{default:t(({row:r})=>[a(o(pe),{content:$(r.username)?"无法移除创建者":"移除成员",placement:"top",disabled:!$(r.username)},{default:t(()=>[a(o(_),{size:"small",type:"danger",onClick:T=>Y(r),disabled:$(r.username)},{default:t(()=>[i(" 移除 ")]),_:2},1032,["onClick","disabled"])]),_:2},1032,["content","disabled"])]),_:1})]),_:1},8,["data"])),[[oe,o(V)]])]),_:1},8,["modelValue"])])}}}),Ee=O(Ve,[["__scopeId","data-v-51acc01f"]]),ke=m=>(P("data-v-4d2ccd98"),m=m(),A(),m),De={class:"common-layout"},xe=ke(()=>b("i",{class:"el-icon-menu"},null,-1)),$e=q({__name:"GroupCreated",setup(m){const d=c(!1),g=()=>{d.value=!d.value};return(u,p)=>{const f=y("el-button"),V=y("el-header"),v=y("el-main"),w=y("el-container");return G(),L("div",De,[a(w,null,{default:t(()=>[a(V,null,{default:t(()=>[a(f,{onClick:g,class:"menu-button"},{default:t(()=>[xe]),_:1})]),_:1}),a(w,{class:"main-container"},{default:t(()=>[b("div",{class:fe(["navigator-overlay",{active:d.value}])},[a(_e,{username:u.$route.query.username},null,8,["username"])],2),a(w,{class:"content-container"},{default:t(()=>[a(v,null,{default:t(()=>[a(Ee,{username:u.$route.query.username},null,8,["username"])]),_:1})]),_:1})]),_:1})]),_:1})])}}}),Ne=O($e,[["__scopeId","data-v-4d2ccd98"]]);export{Ne as default};
