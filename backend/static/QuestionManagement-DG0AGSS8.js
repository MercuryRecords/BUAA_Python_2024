import{d as ne,a as I,r as c,q as K,s as ue,b as u,o as _,c as k,f as e,w as o,e as N,S as de,h as p,F as T,x as S,y as q,z as se,E as f,A as F,T as re,g as A,_ as ie}from"./index-BKtHripP.js";import{_ as ce}from"./NavigatorM.vue_vue_type_script_setup_true_lang-vNEzk7W2.js";const me={class:"common-layout"},_e={class:"problem-list"},pe={class:"dialog-footer"},fe=ne({__name:"QuestionManagement",setup(ge){const U=se(),d=I({keyword:"",tags:[],selectedTags:[],searchType:"key"}),y=c([]),v=c(1),C=c(20);c(!1),c([]);const Q=c([]),x=c([]),j=K(()=>{const l=(v.value-1)*C.value,n=l+C.value;return x.value.slice(l,n)}),L=K(()=>x.value.length),z=()=>{x.value=y.value.filter(l=>{const n=d.keyword===""||l.problem_title.includes(d.keyword)||l.id===parseInt(d.keyword)||l.creator.includes(d.keyword)||l.problem_group_title.includes(d.keyword)||l.content.includes(d.keyword),V=d.selectedTags.length===0||d.selectedTags.every(i=>l.tags.includes(i));return n&&V}),v.value=1,f.success(`找到 ${x.value.length} 个匹配的题目`)},R=l=>{C.value=l,v.value=1},G=l=>{v.value=l},H=l=>l>=.7?"success":l<.3?"danger":"warning";function J(l,n,V){F.post("/admin_get_problems",{username:U.query.username,username_to_search:l,filter_group:n,to_search:V},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(i){if(i.data.code===200){y.value=[];for(let s=0;s<i.data.data.length;s++)console.log(i.data.data[s]),y.value[s]=i.data.data[s],y.value[s].accuracy=i.data.data[s].all_count==0?0:i.data.data[s].all_right_count/i.data.data[s].all_count,console.log(y);z()}else console.log("Mission failed"),f.error(i.data.message),y.value=[]}).catch(function(){console.log("error submit!")})}const $=async()=>{J("","","")};function O(){switch(d.searchType){case"key":return"输入题目关键字";case"group":return"输入群组名称";case"user":return"输入用户名称";default:return"请选择搜索方式"}}const b=c(!1),P=c(null),a=I({problem_title:"",type:"",content:"",ans_count:0,answer:"",field1:"",field2:"",field3:"",field4:"",field5:"",field6:"",field7:"",tags:[]}),W=l=>{P.value=l,a.problem_title=l.problem_title,a.type=l.type,a.content=l.content,a.ans_count=l.ans_count,a.field1=l.field1,a.field2=l.field2,a.field3=l.field3,a.field4=l.field4,a.field5=l.field5,a.field6=l.field6,a.field7=l.field7,a.tags=[...l.tags],b.value=!0},X=()=>{P.value&&(console.log(a.tags),F.post("/admin_problem_update",{username:U.query.username,problem_id:P.value.id,...a},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(l=>{l.data.code===200?(f.success("题目更新成功"),b.value=!1,$()):f.error(l.data.message)}).catch(l=>{console.error("更新题目失败:",l),f.error("更新题目失败，请稍后重试")}))},Y=l=>{re.confirm(`确定要删除题目 "${l.problem_title}" 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{F.post("/admin_problem_delete",{username:U.query.username,problem_id:l.id},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(n=>{n.data.code===200?(f.success("题目删除成功"),$()):f.error(n.data.message)}).catch(n=>{console.error("删除题目失败:",n),f.error("删除题目失败，请稍后重试")})}).catch(()=>{})};return ue(async()=>{await $()}),(l,n)=>{const V=u("el-header"),i=u("el-aside"),s=u("el-option"),D=u("el-select"),r=u("el-form-item"),m=u("el-input"),h=u("el-button"),E=u("el-form"),Z=u("el-card"),g=u("el-table-column"),B=u("el-tag"),ee=u("el-table"),le=u("el-pagination"),te=u("el-main"),M=u("el-container"),ae=u("el-input-number"),oe=u("el-dialog");return _(),k("div",me,[e(M,null,{default:o(()=>[e(V),e(M,null,{default:o(()=>[e(i,{width:"200px"},{default:o(()=>[e(ce,{username:l.$route.query.username},null,8,["username"])]),_:1}),e(M,null,{default:o(()=>[e(te,{class:"shifted-content"},{default:o(()=>[N("div",_e,[e(Z,null,{default:o(()=>[e(E,{inline:!0,model:d,class:"demo-form-inline"},{default:o(()=>[e(r,null,{default:o(()=>[e(D,{modelValue:d.searchType,"onUpdate:modelValue":n[0]||(n[0]=t=>d.searchType=t),placeholder:"搜索方式",style:{width:"180px"}},{default:o(()=>[e(s,{label:"按题目关键字搜索",value:"key"}),e(s,{label:"按群组搜索",value:"group"}),e(s,{label:"按用户搜索",value:"user"})]),_:1},8,["modelValue"])]),_:1}),e(r,null,{default:o(()=>[e(m,{modelValue:d.keyword,"onUpdate:modelValue":n[1]||(n[1]=t=>d.keyword=t),style:{width:"250px"},placeholder:O(),onKeyup:de(z,["enter"])},null,8,["modelValue","placeholder"])]),_:1}),e(r,null,{default:o(()=>[e(h,{onClick:z},{default:o(()=>[p("搜索")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(ee,{data:j.value,style:{width:"100%"}},{default:o(()=>[e(g,{prop:"id",label:"题号",width:"100"}),e(g,{prop:"problem_title",label:"题目名称"}),e(g,{prop:"creator",label:"上传者",width:"100"}),e(g,{prop:"problem_group_title",label:"所属题单",width:"180"}),e(g,{label:"标签",width:"200"},{default:o(t=>[(_(!0),k(T,null,S(t.row.tags,w=>(_(),A(B,{key:w,size:"small",style:{"margin-right":"5px"}},{default:o(()=>[p(q(w),1)]),_:2},1024))),128))]),_:1}),e(g,{prop:"accuracy",label:"正确率",width:"100"},{default:o(t=>[e(B,{type:H(t.row.accuracy),size:"small"},{default:o(()=>[p(q((t.row.accuracy*100).toFixed(2))+"% ",1)]),_:2},1032,["type"])]),_:1}),e(g,{label:"操作",width:"120"},{default:o(t=>[e(h,{type:"text",size:"default",onClick:w=>W(t.row)},{default:o(()=>[p("编辑")]),_:2},1032,["onClick"]),e(h,{type:"text",size:"default",onClick:w=>Y(t.row)},{default:o(()=>[p("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e(le,{class:"pages",onSizeChange:R,onCurrentChange:G,"current-page":v.value,"page-sizes":[10,20,50,100],"page-size":C.value,layout:"total, sizes, jumper, ->, prev, pager, next",total:L.value},null,8,["current-page","page-size","total"])])]),_:1})]),_:1})]),_:1})]),_:1}),e(oe,{modelValue:b.value,"onUpdate:modelValue":n[11]||(n[11]=t=>b.value=t),title:"更新题目",width:"50%"},{footer:o(()=>[N("span",pe,[e(h,{onClick:n[10]||(n[10]=t=>b.value=!1)},{default:o(()=>[p("取消")]),_:1}),e(h,{type:"primary",onClick:X},{default:o(()=>[p("确认")]),_:1})])]),default:o(()=>[e(E,{model:a,"label-width":"100px"},{default:o(()=>[e(r,{label:"题目标题"},{default:o(()=>[e(m,{modelValue:a.problem_title,"onUpdate:modelValue":n[2]||(n[2]=t=>a.problem_title=t)},null,8,["modelValue"])]),_:1}),e(r,{label:"题目类型"},{default:o(()=>[e(B,{type:a.type==="c"?"success":"warning"},{default:o(()=>[p(q(a.type==="c"?"选择题":"填空题"),1)]),_:1},8,["type"])]),_:1}),e(r,{label:"题目内容"},{default:o(()=>[e(m,{modelValue:a.content,"onUpdate:modelValue":n[3]||(n[3]=t=>a.content=t),type:"textarea",rows:4},null,8,["modelValue"])]),_:1}),e(r,{label:"答案数量"},{default:o(()=>[e(ae,{modelValue:a.ans_count,"onUpdate:modelValue":n[4]||(n[4]=t=>a.ans_count=t),min:0},null,8,["modelValue"])]),_:1}),a.type==="c"?(_(),k(T,{key:0},[e(r,{label:"选项A"},{default:o(()=>[e(m,{modelValue:a.field1,"onUpdate:modelValue":n[5]||(n[5]=t=>a.field1=t)},null,8,["modelValue"])]),_:1}),e(r,{label:"选项B"},{default:o(()=>[e(m,{modelValue:a.field2,"onUpdate:modelValue":n[6]||(n[6]=t=>a.field2=t)},null,8,["modelValue"])]),_:1}),e(r,{label:"选项C"},{default:o(()=>[e(m,{modelValue:a.field3,"onUpdate:modelValue":n[7]||(n[7]=t=>a.field3=t)},null,8,["modelValue"])]),_:1}),e(r,{label:"选项D"},{default:o(()=>[e(m,{modelValue:a.field4,"onUpdate:modelValue":n[8]||(n[8]=t=>a.field4=t)},null,8,["modelValue"])]),_:1})],64)):(_(!0),k(T,{key:1},S(a.ans_count,t=>(_(),A(r,{key:t,label:`答案${t}`},{default:o(()=>[e(m,{modelValue:a[`field${t}`],"onUpdate:modelValue":w=>a[`field${t}`]=w},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128)),e(r,{label:"标签"},{default:o(()=>[e(D,{modelValue:a.tags,"onUpdate:modelValue":n[9]||(n[9]=t=>a.tags=t),multiple:"",filterable:"","allow-create":""},{default:o(()=>[(_(!0),k(T,null,S(Q.value.flatMap(t=>t.tags),t=>(_(),A(s,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),ve=ie(fe,[["__scopeId","data-v-5eb241a9"]]);export{ve as default};
