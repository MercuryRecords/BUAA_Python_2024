import{_ as G}from"./Navigator.vue_vue_type_script_setup_true_lang-Ce9qsQIy.js";import{d as R,r as v,a as H,b as u,o as h,c as V,e as n,f as t,w as l,h as i,g as C,n as J,y as x,F as $,x as T,A as k,E as _,Y as K,i as W,p as X,m as Z,_ as A}from"./index-BKtHripP.js";/* empty css                                                                       */const U=w=>(X("data-v-e2533e29"),w=w(),Z(),w),ee={class:"upload-problem-container"},te={class:"panel-container"},oe={class:"left-panel"},le=U(()=>n("div",{class:"panel-header"},[n("h2",null,"OCR识别结果")],-1)),ae={class:"upload-button-container"},ne=U(()=>n("div",{class:"el-upload__tip"}," 支持jpg/png/pdf文件，大小不超过5MB ",-1)),se={class:"right-panel"},de=U(()=>n("div",{class:"panel-header"},[n("h2",null,"题目信息")],-1)),re={class:"answer-count-controls"},ue={class:"tags-container"},ce={class:"tag-buttons"},ie={class:"dialog-footer"},pe={class:"submit-button-container"},_e=R({__name:"UploadQuestion",props:["username","sheetId"],setup(w){v([]);const e=H({username:"",title:"",problem_group_id:0,type:"",content:"",ans_count:1,answer:"",field1:"",field2:"",field3:"",field4:"",field5:"",field6:"",field7:"",tags:[],answers:[""]}),y=v(""),m=v(!1),f=v(""),b=v(null),c=w,B=async s=>{const{file:o}=s,d=new FormData;d.append("username",c.username),d.append("file",o);try{const r=await k.post("/ocr",d,{headers:{"Content-Type":"multipart/form-data"}});console.log(r.data.code),y.value=r.data.text,_.success("文件上传成功，OCR识别结果已更新")}catch(r){console.error("上传失败:",r),_.error("文件上传失败，请重试")}},S=s=>{e.tags=e.tags.filter(o=>o!==s)},q=()=>{m.value=!0,K(()=>{b.value&&b.value.focus()})},D=()=>{f.value&&e.tags.push(f.value),m.value=!1,f.value=""},E=()=>{e.ans_count=1,e.answer="",e.answers=[""]},F=()=>{e.ans_count<7&&(e.ans_count++,e.answers.push(""))},N=()=>{e.ans_count>1&&(e.ans_count--,e.answers.pop())},Q=()=>{const s={username:c.username,title:e.title,problem_group_id:c.sheetId,type:e.type,content:e.content,ans_count:e.ans_count,answer:e.answer,field1:e.field1,field2:e.field2,field3:e.field3,field4:e.field4,field5:e.field5,field6:e.field6,field7:e.field7,tags:e.tags};for(let o=0;o<e.ans_count;o++)s[`field${o+1}`]=e.answers[o];console.log(s),k.post("/problem_create",s,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(o=>{o.data.code===200?(console.log("提交成功:",o.data),_.success("题目提交成功"),setTimeout(()=>{W.go(-1)},1e3)):(console.log("提交失败:",o.data),_.error("题目提交失败"))}).catch(o=>{console.error("提交失败:",o),_.error("题目提交失败，请重试")})},O=async()=>{try{console.log(c.username),console.log(e.content);const s=await k.post("/extract_keywords",{username:c.username,text:e.content},{headers:{"Content-Type":"application/x-www-form-urlencoded"}});s.data.code===200?(s.data.keywords.forEach(d=>{e.tags.includes(d)||e.tags.push(d)}),_.success("已添加推荐标签")):_.warning("获取推荐标签失败")}catch(s){console.error("获取推荐标签出错:",s),_.error("获取推荐标签失败，请重试")}};return(s,o)=>{const d=u("el-input"),r=u("el-button"),z=u("el-upload"),p=u("el-form-item"),I=u("el-option"),M=u("el-select"),P=u("el-tag"),j=u("el-dialog"),L=u("el-form");return h(),V("div",ee,[n("div",te,[n("div",oe,[le,t(d,{type:"textarea",modelValue:y.value,"onUpdate:modelValue":o[0]||(o[0]=a=>y.value=a),rows:64,class:"ocr-textarea",placeholder:"OCR识别结果将显示在这里，处理会有点慢，请耐心等候~"},null,8,["modelValue"]),n("div",ae,[t(z,{class:"upload-demo",action:"#","http-request":B,"show-file-list":!1},{default:l(()=>[t(r,{type:"primary"},{default:l(()=>[i("上传题目文件")]),_:1})]),_:1})]),ne]),n("div",se,[de,t(L,{model:e,"label-width":"120px","label-position":"left"},{default:l(()=>[t(p,{label:"题目名称"},{default:l(()=>[t(d,{modelValue:e.title,"onUpdate:modelValue":o[1]||(o[1]=a=>e.title=a),placeholder:"请输入题目名称"},null,8,["modelValue"])]),_:1}),t(p,{label:"题目类型"},{default:l(()=>[t(M,{modelValue:e.type,"onUpdate:modelValue":o[2]||(o[2]=a=>e.type=a),placeholder:"请选择题目类型",onChange:E},{default:l(()=>[t(I,{label:"选择题",value:"c"}),t(I,{label:"填空题",value:"b"})]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"题目内容"},{default:l(()=>[t(d,{type:"textarea",modelValue:e.content,"onUpdate:modelValue":o[3]||(o[3]=a=>e.content=a),rows:6,placeholder:"请输入题目内容"},null,8,["modelValue"])]),_:1}),e.type==="c"?(h(),C(p,{key:0,label:"正确答案"},{default:l(()=>[t(d,{modelValue:e.answer,"onUpdate:modelValue":o[4]||(o[4]=a=>e.answer=a),placeholder:"请输入正确答案（如：A）"},null,8,["modelValue"])]),_:1})):J("",!0),t(p,{label:e.type==="c"?"选项数量":"答案数量"},{default:l(()=>[n("div",re,[t(r,{onClick:N,disabled:e.ans_count<=1},{default:l(()=>[i("-")]),_:1},8,["disabled"]),n("span",null,x(e.ans_count),1),t(r,{onClick:F,disabled:e.ans_count>=7},{default:l(()=>[i("+")]),_:1},8,["disabled"])])]),_:1},8,["label"]),(h(!0),V($,null,T(e.answers,(a,g)=>(h(),C(p,{key:g,label:e.type==="c"?`选项${String.fromCharCode(65+g)}`:`答案 ${g+1}`},{default:l(()=>[t(d,{modelValue:e.answers[g],"onUpdate:modelValue":Y=>e.answers[g]=Y},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128)),t(p,{label:"题目标签"},{default:l(()=>[n("div",ue,[(h(!0),V($,null,T(e.tags,a=>(h(),C(P,{key:a,closable:"",onClose:g=>S(a)},{default:l(()=>[i(x(a),1)]),_:2},1032,["onClose"]))),128)),n("div",ce,[t(r,{class:"button-new-tag",size:"small",onClick:q},{default:l(()=>[i(" + 新标签 ")]),_:1}),t(r,{class:"button-new-tag",size:"small",onClick:O,type:"danger"},{default:l(()=>[i(" 推荐标签 ")]),_:1})])])]),_:1}),t(j,{modelValue:m.value,"onUpdate:modelValue":o[7]||(o[7]=a=>m.value=a),title:"添加新标签",width:"30%"},{footer:l(()=>[n("span",ie,[t(r,{onClick:o[6]||(o[6]=a=>m.value=!1)},{default:l(()=>[i("取消")]),_:1}),t(r,{type:"primary",onClick:D},{default:l(()=>[i(" 确定 ")]),_:1})])]),default:l(()=>[t(d,{modelValue:f.value,"onUpdate:modelValue":o[5]||(o[5]=a=>f.value=a),ref_key:"inputRef",ref:b,placeholder:"请输入标签名称"},null,8,["modelValue"])]),_:1},8,["modelValue"]),t(p,null,{default:l(()=>[n("div",pe,[t(r,{type:"primary",onClick:Q},{default:l(()=>[i("提交题目")]),_:1})])]),_:1})]),_:1},8,["model"])])])])}}}),me=A(_e,[["__scopeId","data-v-e2533e29"]]),fe={class:"common-layout"},he=R({__name:"QuestionUploaded",setup(w){return(e,y)=>{const m=u("el-header"),f=u("el-aside"),b=u("el-main"),c=u("el-container");return h(),V("div",fe,[t(c,null,{default:l(()=>[t(m),t(c,{class:"main-container"},{default:l(()=>[t(f,{width:"200px",class:"navigation-aside"},{default:l(()=>[t(G,{username:e.$route.query.username},null,8,["username"])]),_:1}),t(c,null,{default:l(()=>[t(b,{class:"shifted-content"},{default:l(()=>[t(me,{username:e.$route.query.username,sheetId:e.$route.query.sheetId},null,8,["username","sheetId"])]),_:1})]),_:1})]),_:1})]),_:1})])}}}),ve=A(he,[["__scopeId","data-v-b8b6cdb6"]]);export{ve as default};
