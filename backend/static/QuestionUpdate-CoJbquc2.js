import{_ as J}from"./Navigator.vue_vue_type_script_setup_true_lang-Ce9qsQIy.js";import{d as D,r as y,a as K,s as W,b as i,o as b,c as C,e as r,f as o,w as l,h as p,g as k,n as X,y as $,F as T,x,A as V,E as c,Y as Z,i as R,p as ee,m as te,_ as q}from"./index-BKtHripP.js";const U=h=>(ee("data-v-3a56e103"),h=h(),te(),h),oe={class:"upload-problem-container"},le={class:"panel-container"},ae={class:"left-panel"},ne=U(()=>r("div",{class:"panel-header"},[r("h2",null,"OCR识别结果")],-1)),se={class:"upload-button-container"},de=U(()=>r("div",{class:"el-upload__tip"}," 支持jpg/png/pdf文件，大小不超过5MB ",-1)),re={class:"right-panel"},ue=U(()=>r("div",{class:"panel-header"},[r("h2",null,"题目信息")],-1)),ie={class:"answer-count-controls"},ce={class:"tags-container"},pe={class:"tag-buttons"},_e={class:"dialog-footer"},me={class:"submit-button-container"},fe=D({__name:"UpdateQuestion",props:["username","sheetId","problem_id"],setup(h){y([]);const e=K({username:"",title:"",problem_group_id:0,type:"",content:"",ans_count:1,answer:"",field1:"",field2:"",field3:"",field4:"",field5:"",field6:"",field7:"",tags:[],answers:[""]}),v=y(""),m=y(!1),f=y(""),g=y(null),d=h,A=async()=>{try{const n=await V.post("/get_problem_detail",{username:d.username,problem_id:d.problem_id},{headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(n.data.code===200){const t=n.data.data;e.username=t.creator||"",e.title=t.problem_title||"",e.problem_group_id=t.problem_group_id||0,e.type=t.type||"",e.content=t.content||"",e.ans_count=t.ans_count||1,e.answer=t.answer||"",e.field1=t.field1||"",e.field2=t.field2||"",e.field3=t.field3||"",e.field4=t.field4||"",e.field5=t.field5||"",e.field6=t.field6||"",e.field7=t.field7||"",e.tags=t.tags||[],e.answers=[];for(let s=1;s<=e.ans_count;s++)e.answers.push(e[`field${s}`]||"")}else c.error("获取题目信息失败")}catch(n){console.error("获取题目信息出错:",n),c.error("获取题目信息失败，请重试")}},B=async n=>{const{file:t}=n,s=new FormData;s.append("username",d.username),s.append("file",t);try{const u=await V.post("/ocr",s,{headers:{"Content-Type":"multipart/form-data"}});console.log(u.data.code),v.value=u.data.text,c.success("文件上传成功，OCR识别结果已更新")}catch(u){console.error("上传失败:",u),c.error("文件上传失败，请重试")}},S=n=>{e.tags=e.tags.filter(t=>t!==n)},E=()=>{m.value=!0,Z(()=>{g.value&&g.value.focus()})},F=()=>{f.value&&e.tags.push(f.value),m.value=!1,f.value=""},N=()=>{e.ans_count=1,e.answer="",e.answers=[""]},Q=()=>{e.ans_count<7&&(e.ans_count++,e.answers.push(""))},M=()=>{e.ans_count>1&&(e.ans_count--,e.answers.pop())},O=()=>{const n={username:d.username,problem_id:d.problem_id,title:e.title,problem_group_id:d.sheetId,type:e.type,content:e.content,ans_count:e.ans_count,answer:e.answer,field1:e.field1,field2:e.field2,field3:e.field3,field4:e.field4,field5:e.field5,field6:e.field6,field7:e.field7,tags:e.tags};for(let t=0;t<e.ans_count;t++)n[`field${t+1}`]=e.answers[t];V.post("/problem_update",n,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(t=>{t.data.code===200?(console.log("操作成功:",t.data),c.success(d.problem_id?"题目更新成功":"题目提交成功"),setTimeout(()=>{R.go(-1)},1e3)):(console.log("操作失败:",t.data),c.error(d.problem_id?"题目更新失败":"题目提交失败"))}).catch(t=>{console.error("操作失败:",t),c.error(d.problem_id?"题目更新失败，请重试":"题目提交失败，请重试")}),setTimeout(()=>{R.go(0)},1e3)},P=async()=>{try{console.log(d.username),console.log(e.content);const n=await V.post("/extract_keywords",{username:d.username,text:e.content},{headers:{"Content-Type":"application/x-www-form-urlencoded"}});n.data.code===200?(n.data.keywords.forEach(s=>{e.tags.includes(s)||e.tags.push(s)}),c.success("已添加推荐标签")):c.warning("获取推荐标签失败")}catch(n){console.error("获取推荐标签出错:",n),c.error("获取推荐标签失败，请重试")}};return W(()=>{d.problem_id&&A()}),(n,t)=>{const s=i("el-input"),u=i("el-button"),z=i("el-upload"),_=i("el-form-item"),I=i("el-option"),j=i("el-select"),L=i("el-tag"),Y=i("el-dialog"),G=i("el-form");return b(),C("div",oe,[r("div",le,[r("div",ae,[ne,o(s,{type:"textarea",modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=a=>v.value=a),rows:64,class:"ocr-textarea",placeholder:"OCR识别结果将显示在这里，处理会有点慢，请耐心等候~"},null,8,["modelValue"]),r("div",se,[o(z,{class:"upload-demo",action:"#","http-request":B,"show-file-list":!1},{default:l(()=>[o(u,{type:"primary"},{default:l(()=>[p("上传题目文件")]),_:1})]),_:1})]),de]),r("div",re,[ue,o(G,{model:e,"label-width":"120px","label-position":"left"},{default:l(()=>[o(_,{label:"题目名称"},{default:l(()=>[o(s,{modelValue:e.title,"onUpdate:modelValue":t[1]||(t[1]=a=>e.title=a),placeholder:"请输入题目名称"},null,8,["modelValue"])]),_:1}),o(_,{label:"题目类型"},{default:l(()=>[o(j,{modelValue:e.type,"onUpdate:modelValue":t[2]||(t[2]=a=>e.type=a),placeholder:"请选择题目类型",onChange:N},{default:l(()=>[o(I,{label:"选择题",value:"c"}),o(I,{label:"填空题",value:"b"})]),_:1},8,["modelValue"])]),_:1}),o(_,{label:"题目内容"},{default:l(()=>[o(s,{type:"textarea",modelValue:e.content,"onUpdate:modelValue":t[3]||(t[3]=a=>e.content=a),rows:6,placeholder:"请输入题目内容"},null,8,["modelValue"])]),_:1}),e.type==="c"?(b(),k(_,{key:0,label:"正确答案"},{default:l(()=>[o(s,{modelValue:e.answer,"onUpdate:modelValue":t[4]||(t[4]=a=>e.answer=a),placeholder:"请输入正确答案（如：A）"},null,8,["modelValue"])]),_:1})):X("",!0),o(_,{label:e.type==="c"?"选项数量":"答案数量"},{default:l(()=>[r("div",ie,[o(u,{onClick:M,disabled:e.ans_count<=1},{default:l(()=>[p("-")]),_:1},8,["disabled"]),r("span",null,$(e.ans_count),1),o(u,{onClick:Q,disabled:e.ans_count>=7},{default:l(()=>[p("+")]),_:1},8,["disabled"])])]),_:1},8,["label"]),(b(!0),C(T,null,x(e.answers,(a,w)=>(b(),k(_,{key:w,label:e.type==="c"?`选项${String.fromCharCode(65+w)}`:`答案 ${w+1}`},{default:l(()=>[o(s,{modelValue:e.answers[w],"onUpdate:modelValue":H=>e.answers[w]=H},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128)),o(_,{label:"题目标签"},{default:l(()=>[r("div",ce,[(b(!0),C(T,null,x(e.tags,a=>(b(),k(L,{key:a,closable:"",onClose:w=>S(a)},{default:l(()=>[p($(a),1)]),_:2},1032,["onClose"]))),128)),r("div",pe,[o(u,{class:"button-new-tag",size:"small",onClick:E},{default:l(()=>[p(" + 新标签 ")]),_:1}),o(u,{class:"button-new-tag",size:"small",onClick:P,type:"danger"},{default:l(()=>[p(" 推荐标签 ")]),_:1})])])]),_:1}),o(Y,{modelValue:m.value,"onUpdate:modelValue":t[7]||(t[7]=a=>m.value=a),title:"添加新标签",width:"30%"},{footer:l(()=>[r("span",_e,[o(u,{onClick:t[6]||(t[6]=a=>m.value=!1)},{default:l(()=>[p("取消")]),_:1}),o(u,{type:"primary",onClick:F},{default:l(()=>[p(" 确定 ")]),_:1})])]),default:l(()=>[o(s,{modelValue:f.value,"onUpdate:modelValue":t[5]||(t[5]=a=>f.value=a),ref_key:"inputRef",ref:g,placeholder:"请输入标签名称"},null,8,["modelValue"])]),_:1},8,["modelValue"]),o(_,null,{default:l(()=>[r("div",me,[o(u,{type:"primary",onClick:O},{default:l(()=>[p("提交题目")]),_:1})])]),_:1})]),_:1},8,["model"])])])])}}}),be=q(fe,[["__scopeId","data-v-3a56e103"]]),he={class:"common-layout"},we=D({__name:"QuestionUpdate",setup(h){return(e,v)=>{const m=i("el-header"),f=i("el-aside"),g=i("el-main"),d=i("el-container");return b(),C("div",he,[o(d,null,{default:l(()=>[o(m),o(d,{class:"main-container"},{default:l(()=>[o(f,{width:"200px",class:"navigation-aside"},{default:l(()=>[o(J,{username:e.$route.query.username},null,8,["username"])]),_:1}),o(d,null,{default:l(()=>[o(g,{class:"shifted-content"},{default:l(()=>[o(be,{username:e.$route.query.username,sheetId:e.$route.query.sheetId,problem_id:e.$route.query.problem_id},null,8,["username","sheetId","problem_id"])]),_:1})]),_:1})]),_:1})]),_:1})])}}}),ve=q(we,[["__scopeId","data-v-ed5ea97b"]]);export{ve as default};
