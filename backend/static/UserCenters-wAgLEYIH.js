import{_ as z}from"./Navigator.vue_vue_type_script_setup_true_lang-Ce9qsQIy.js";import{d as T,a as M,s as j,A as P,r as q,b as s,o as D,c as F,f as e,w as a,e as d,y as U,h as u,F as J,x as H,a1 as K,E as r,R as O,p as Q,m as W,_ as $}from"./index-BKtHripP.js";const X=p=>(Q("data-v-adaa3500"),p=p(),W(),p),Y={class:"personal-center"},Z=X(()=>d("div",{class:"card-header"},[d("span",null,"查看您的信息")],-1)),ee={class:"info-content"},ae={class:"avatar-section"},oe={class:"user-details"},se={class:"card-footer"},te={class:"dialog-footer"},ne=T({__name:"UserCenter",props:["username"],setup(p){const v=K(),i=p,c=M({name:i.username,avatar:"path_to_avatar_image",studentId:"22371500",role:"User",email:"22371500@buaa.edu.cn",createdAt:"2024-02-19",currentCourse:"2024春-操作系统"}),C={studentId:i.username,role:c.role},V={studentId:"el-icon-user",role:"el-icon-s-custom"},f={studentId:"用户名",role:"用户身份"},A=o=>{const n=o.raw.type==="image/jpeg",b=o.raw.type==="image/png",m=o.raw.size/1024/1024<2;if(!n&&!b){r.error("头像图片只能是 JPG 或 PNG 格式!");return}if(!m){r.error("头像图片大小不能超过 2MB!");return}const h=new FormData;h.append("username",i.username),h.append("avatar",o.raw),P.post("/edit_avatar",h,{headers:{"Content-Type":"multipart/form-data"}}).then(_=>{if(_.data.code===200){const y=new FileReader;y.readAsDataURL(o.raw),y.onload=g=>{g.target&&g.target.result?(c.avatar=g.target.result,r.success("头像更新成功"),console.log(o.raw)):r.error("头像加载失败")}}else r.error("头像更新失败: "+_.data.message)}).catch(_=>{console.error("Error:",_),r.error("头像更新失败，请稍后重试")})};j(async()=>N());function N(){P.post("/get_avatar",{username:i.username},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(o=>{o.data.code===200?(c.avatar=o.data.avatar,console.log(o.data.message)):(console.log("Failed to fetch avatar:",o.data.message),c.avatar="path_to_default_avatar_image")}).catch(o=>{console.error("Error fetching avatar:",o),c.avatar="path_to_default_avatar_image"})}const B=()=>{P.post("/user_logout",{username:i.username},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(o){o.data.code===200?(console.log("退！"),r.success("退出成功！"),setTimeout(()=>{v.push("/login")},1e3)):console.log("Failed to logout:",o.data.message)}).catch(function(){console.log("error")})},w=q(!1),t=M({oldPassword:"",newPassword:"",confirmPassword:""}),G=()=>{w.value=!0},L=()=>{if(console.log("修改密码",t),t.newPassword!==t.confirmPassword){r.error("新密码和确认密码不一致");return}P.post("/user_change_password",{username:i.username,password:t.oldPassword,new_password:t.newPassword,usertype:"1"},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(o=>{o.data.code===200?(r.success("密码修改成功"),w.value=!1):r.error("密码修改失败: "+o.data.message)}).catch(o=>{console.error("Error:",o),r.error("密码修改失败，请稍后重试")})};return(o,n)=>{const b=s("el-avatar"),m=s("el-link"),h=s("el-upload"),_=s("el-col"),y=s("el-row"),g=s("el-card"),I=s("el-input"),k=s("el-form-item"),R=s("el-form"),E=s("el-button"),S=s("el-dialog");return D(),F("div",Y,[e(g,{class:"info-card"},{header:a(()=>[Z]),default:a(()=>[d("div",ee,[d("div",ae,[e(b,{size:100,src:c.avatar},null,8,["src"]),d("h2",null,U(c.name),1),e(h,{class:"avatar-uploader",action:"#","show-file-list":!1,"on-change":A,"auto-upload":!1,accept:".jpg,.png"},{default:a(()=>[e(m,{type:"primary",class:"edit-avatar"},{default:a(()=>[u("修改头像")]),_:1})]),_:1})]),d("div",oe,[(D(),F(J,null,H(C,(l,x)=>e(y,{class:"info-row",key:x},{default:a(()=>[e(_,{span:8,class:"info-label"},{default:a(()=>[d("i",{class:O(V[x])},null,2),u(" "+U(f[x]),1)]),_:2},1024),e(_,{span:16,class:"info-value"},{default:a(()=>[u(U(l),1)]),_:2},1024)]),_:2},1024)),64))])]),d("div",se,[e(m,{type:"danger",class:"footer-link"},{default:a(()=>[u("* 若您的个人信息有误，请联系系统管理员")]),_:1}),d("div",null,[e(m,{type:"primary",class:"footer-link",onClick:G},{default:a(()=>[u("修改密码")]),_:1}),e(m,{type:"primary",class:"footer-link",onClick:B},{default:a(()=>[u("退出登录")]),_:1})])])]),_:1}),e(S,{title:"修改密码",modelValue:w.value,"onUpdate:modelValue":n[4]||(n[4]=l=>w.value=l),width:"30%","close-on-click-modal":!1},{footer:a(()=>[d("span",te,[e(E,{type:"primary",onClick:L},{default:a(()=>[u("确认修改")]),_:1}),e(E,{onClick:n[3]||(n[3]=l=>w.value=!1)},{default:a(()=>[u("取消修改")]),_:1})])]),default:a(()=>[e(R,{model:t,"label-width":"80px"},{default:a(()=>[e(k,{label:"旧密码"},{default:a(()=>[e(I,{modelValue:t.oldPassword,"onUpdate:modelValue":n[0]||(n[0]=l=>t.oldPassword=l),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),e(k,{label:"新密码"},{default:a(()=>[e(I,{modelValue:t.newPassword,"onUpdate:modelValue":n[1]||(n[1]=l=>t.newPassword=l),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),e(k,{label:"确认密码"},{default:a(()=>[e(I,{modelValue:t.confirmPassword,"onUpdate:modelValue":n[2]||(n[2]=l=>t.confirmPassword=l),type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),re=$(ne,[["__scopeId","data-v-adaa3500"]]),le={class:"common-layout"},de=T({__name:"UserCenters",setup(p){return(v,i)=>{const c=s("el-header"),C=s("el-aside"),V=s("el-main"),f=s("el-container");return D(),F("div",le,[e(f,null,{default:a(()=>[e(c),e(f,null,{default:a(()=>[e(C,{width:"200px"},{default:a(()=>[e(z,{username:v.$route.query.username},null,8,["username"])]),_:1}),e(f,null,{default:a(()=>[e(V,{class:"shifted-content"},{default:a(()=>[e(re,{username:v.$route.query.username},null,8,["username"])]),_:1})]),_:1})]),_:1})]),_:1})])}}}),ie=$(de,[["__scopeId","data-v-28d4d91b"]]);export{ie as default};
