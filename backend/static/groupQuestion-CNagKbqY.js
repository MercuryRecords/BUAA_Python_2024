import{d as ye,a as D,r as i,q as K,s as he,b as s,o as u,c as p,f as o,w as a,e as G,S as we,h as r,F as k,x as C,y as h,n as ve,z as be,A as z,E as g,i as L,g as x,_ as ke}from"./index-BKtHripP.js";import{_ as Ce}from"./Navigator.vue_vue_type_script_setup_true_lang-Ce9qsQIy.js";const xe={class:"common-layout"},Te={class:"problem-list"},Ve={class:"el-dropdown-link"},qe={key:0,style:{"margin-top":"10px"}},ze={class:"dialog-footer"},Se=ye({__name:"groupQuestion",setup(Pe){const _=be(),l=D({keyword:"",tags:[],selectedTags:[]}),T=i([]),w=i(1),V=i(20),v=i(!1),S=i([]),E=i([]);async function j(){try{const e=await z.post("/get_user_tags",{username:_.query.username},{headers:{"Content-Type":"application/x-www-form-urlencoded"}});e.data.code===200?(S.value=e.data.data.filter(t=>!["选择题","选择","填空题","填空"].includes(t)),E.value=[{name:"所有标签",tags:S.value},{name:"题目类型",tags:["选择题","填空题"]}],console.log("Get the tags",S.value)):g.error(e.data.message)}catch(e){console.error("Error fetching user tags:",e),g.error("获取标签失败")}}const P=i([]),$=K(()=>{const e=(w.value-1)*V.value,t=e+V.value;return P.value.slice(e,t)}),N=K(()=>P.value.length),f=()=>{P.value=T.value.filter(e=>{const t=l.keyword===""||e.problem_title.includes(l.keyword)||e.id===parseInt(l.keyword)||e.creator.includes(l.keyword)||e.problem_group_title.includes(l.keyword)||e.content.includes(l.keyword),c=l.selectedTags.length===0||l.selectedTags.every(b=>e.tags.includes(b));return t&&c}),w.value=1,g.success(`找到 ${N.value} 个匹配的题目`)},M=e=>{V.value=e,w.value=1},R=e=>{w.value=e},H=(e,t)=>{g.success(`准备解决题目: ${e.problem_title}`);const c=$.value,b=c.findIndex(I=>I.id===e.id);console.log(t),console.log(c),L.push({name:"solve",query:{username:_.query.username,index:b,problem_group_id:t}})},J=e=>{const t=$.value.map(c=>c.id);console.log(t),z.post("/temporary_problem_group_create",{username:_.query.username,problem_ids:t},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(c){c.data.code===200?(console.log("Ready to solve"),H(e,c.data.data)):g.error(c.data.message)}).catch(function(){console.log("error submit!")})},O=()=>{l.keyword="",l.tags=[],l.selectedTags=[],f()},W=()=>{v.value=!0},X=()=>{v.value=!1,l.selectedTags=[...l.tags],f()},Y=e=>{l.selectedTags=l.selectedTags.filter(t=>t!==e),l.tags=l.tags.filter(t=>t!==e),f()},Z=e=>e>=.7?"success":e<.3?"danger":"warning";function ee(){z.post("/get_problems",{username:_.query.username,filter_group:_.query.groupLabel},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){if(e.data.code===200){for(let t=0;t<e.data.data.length;t++)console.log(e.data.data[t]),T.value[t]=e.data.data[t],T.value[t].accuracy=e.data.data[t].all_count==0?0:e.data.data[t].all_right_count/e.data.data[t].all_count,console.log(T);f()}else g.error(e.data.message)}).catch(function(){console.log("error submit!")})}const te=async()=>{ee()},Q=D([]),oe=async()=>{z.post("/group_get_groups",{username:_.query.username},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){if(e.data.code===200)for(let t=0;t<e.data.groups.length;t++)Q.push(e.data.groups[t].name);else g.error(e.data.message)}).catch(function(){console.log("error submit!")})},U=i(""),ae=e=>{U.value=e,e!==""&&L.push({name:"QuestionBank4SpecificGroup",query:{username:_.query.username,groupLabel:e}})};return he(async()=>{await j(),await te(),await oe()}),(e,t)=>{const c=s("el-header"),b=s("el-aside"),I=s("el-input"),q=s("el-form-item"),y=s("el-button"),le=s("el-icon"),A=s("el-dropdown-item"),ne=s("el-dropdown-menu"),se=s("el-dropdown"),re=s("el-form"),B=s("el-tag"),ce=s("el-card"),m=s("el-table-column"),ue=s("el-table"),de=s("el-pagination"),ie=s("el-main"),F=s("el-container"),_e=s("el-checkbox"),me=s("el-checkbox-group"),pe=s("el-tab-pane"),ge=s("el-tabs"),fe=s("el-dialog");return u(),p("div",xe,[o(F,null,{default:a(()=>[o(c),o(F,null,{default:a(()=>[o(b,{width:"200px"},{default:a(()=>[o(Ce,{username:e.$route.query.username},null,8,["username"])]),_:1}),o(F,null,{default:a(()=>[o(ie,{class:"shifted-content"},{default:a(()=>[G("div",Te,[o(ce,null,{default:a(()=>[o(re,{inline:!0,model:l,class:"demo-form-inline"},{default:a(()=>[o(q,null,{default:a(()=>[o(I,{modelValue:l.keyword,"onUpdate:modelValue":t[0]||(t[0]=n=>l.keyword=n),placeholder:"搜索关键词（题号、标题、上传者、所属题单）",style:{width:"310px"},onKeyup:we(f,["enter"])},null,8,["modelValue"])]),_:1}),o(q,null,{default:a(()=>[o(y,{onClick:f},{default:a(()=>[r("搜索")]),_:1})]),_:1}),o(q,null,{default:a(()=>[o(y,{onClick:W},{default:a(()=>[r("选择标签")]),_:1})]),_:1}),o(q,null,{default:a(()=>[o(y,{type:"primary",onClick:O},{default:a(()=>[r("清除所有筛选条件")]),_:1})]),_:1}),o(se,{onCommand:ae},{dropdown:a(()=>[o(ne,null,{default:a(()=>[o(A,{command:""},{default:a(()=>[r("全部群组")]),_:1}),(u(!0),p(k,null,C(Q,n=>(u(),x(A,{key:n,command:n},{default:a(()=>[r(h(n),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:a(()=>[G("span",Ve,[r(h(U.value||"选择群组")+" ",1),o(le,{class:"el-icon--right"})])]),_:1})]),_:1},8,["model"]),l.selectedTags.length>0?(u(),p("div",qe,[(u(!0),p(k,null,C(l.selectedTags,n=>(u(),x(B,{key:n,closable:"",onClose:d=>Y(n),style:{"margin-right":"5px"}},{default:a(()=>[r(h(n),1)]),_:2},1032,["onClose"]))),128))])):ve("",!0)]),_:1}),o(ue,{data:$.value,style:{width:"100%"}},{default:a(()=>[o(m,{prop:"id",label:"题号",width:"100"}),o(m,{prop:"problem_title",label:"题目名称"}),o(m,{prop:"creator",label:"上传者",width:"100"}),o(m,{prop:"problem_group_title",label:"所属题单",width:"180"}),o(m,{label:"标签",width:"200"},{default:a(n=>[(u(!0),p(k,null,C(n.row.tags,d=>(u(),x(B,{key:d,size:"small",style:{"margin-right":"5px"}},{default:a(()=>[r(h(d),1)]),_:2},1024))),128))]),_:1}),o(m,{prop:"accuracy",label:"正确率",width:"100"},{default:a(n=>[o(B,{type:Z(n.row.accuracy),size:"small"},{default:a(()=>[r(h((n.row.accuracy*100).toFixed(2))+"% ",1)]),_:2},1032,["type"])]),_:1}),o(m,{label:"操作",width:"100"},{default:a(n=>[o(y,{type:"text",size:"small",onClick:d=>J(n.row)},{default:a(()=>[r("解题")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),o(de,{class:"pages",onSizeChange:M,onCurrentChange:R,"current-page":w.value,"page-sizes":[10,20,50,100],"page-size":V.value,layout:"total, sizes, prev, pager, next, jumper",total:N.value},null,8,["current-page","page-size","total"])])]),_:1})]),_:1})]),_:1})]),_:1}),o(fe,{modelValue:v.value,"onUpdate:modelValue":t[3]||(t[3]=n=>v.value=n),title:"选择标签",width:"50%"},{footer:a(()=>[G("span",ze,[o(y,{onClick:t[2]||(t[2]=n=>v.value=!1)},{default:a(()=>[r("取消")]),_:1}),o(y,{type:"primary",onClick:X},{default:a(()=>[r("确认")]),_:1})])]),default:a(()=>[o(ge,{type:"border-card"},{default:a(()=>[(u(!0),p(k,null,C(E.value,n=>(u(),x(pe,{key:n.name,label:n.name},{default:a(()=>[o(me,{modelValue:l.tags,"onUpdate:modelValue":t[1]||(t[1]=d=>l.tags=d)},{default:a(()=>[(u(!0),p(k,null,C(n.tags,d=>(u(),x(_e,{key:d,label:d},{default:a(()=>[r(h(d),1)]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1},8,["modelValue"])])}}}),Be=ke(Se,[["__scopeId","data-v-ca010d9d"]]);export{Be as default};
