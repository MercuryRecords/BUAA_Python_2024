import{_ as de}from"./NavigatorM.vue_vue_type_script_setup_true_lang-vNEzk7W2.js";import{d as R,r as d,q as F,s as ie,b as r,o as g,c as z,f as t,w as o,e as s,u as me,h as u,y as x,g as T,n as pe,A as S,E as c,T as _e,a0 as ve,p as H,m as O,_ as Q,R as fe}from"./index-BKtHripP.js";const D=m=>(H("data-v-b0cad75c"),m=m(),O(),m),ge={class:"group-management"},he={class:"search-container"},we={class:"table-container"},be=D(()=>s("div",{class:"table-header"},[s("h2",null,"群组列表")],-1)),ye=D(()=>s("strong",null,"群组名：",-1)),ke=D(()=>s("strong",null,"创建者：",-1)),Ce=D(()=>s("strong",null,"创建时间：",-1)),Ve={class:"description-container"},Me=D(()=>s("strong",null,"描述：",-1)),$e={key:0},xe={class:"dialog-footer"},q=10,Se=R({__name:"Groups",props:["username"],setup(m){const _=m,y=d([]),v=d(1),k=d(!1),h=d(!1),w=d(!1),n=d({}),p=d({username:""}),C=d(),E=d(""),I=d(!0),b=d(""),Y={username:[{required:!0,message:"请输入用户名",trigger:"blur"}]},A=F(()=>E.value?y.value.filter(a=>a.name.toLowerCase().includes(E.value.toLowerCase())):y.value),j=F(()=>{const a=(v.value-1)*q,e=a+q;return A.value.slice(a,e)}),B=async()=>{try{const a=await S.post("/admin_get_group_list",{username:_.username},{headers:{"Content-Type":"application/x-www-form-urlencoded"}});a.data.code===200?y.value=a.data.data:(console.error("Failed to fetch groups:",a.data.message),c.error(a.data.message))}catch(a){console.error("Error fetching groups:",a),c.error("获取群组列表失败")}},J=a=>{n.value=a,b.value=a.description,k.value=!0},K=a=>{n.value=a,h.value=!0},W=async a=>{await _e.confirm("确定要删除这个群组吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),S.post("/admin_delete_group",{username:_.username,group_name:a},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){e.data.code===200?(c.success(e.data.message),B()):c.error(e.data.message)}).catch(function(){console.log("error submit!")})},X=a=>{v.value=a},Z=()=>{w.value=!0},P=()=>{w.value=!1,p.value={username:""},C.value&&C.value.resetFields()},ee=()=>{C.value&&C.value.validate(a=>{a?S.post("/admin_add_user_to_group",{username:_.username,name:p.value.username,group_name:n.value.name},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(e=>{e.data.code===200?(c.success(e.data.message),n.value.members.push(p.value.username),P()):c.error(e.data.message)}).catch(e=>{console.error("Error adding member:",e),c.error("添加成员失败")}):console.log("表单验证失败")})},ae=a=>{S.post("/admin_remove_user_from_group",{username:_.username,name:a,group_name:n.value.name},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(e=>{e.data.code===200?a===n.value.creator?(c.warning("踢出群主，已解散该群组"),h.value=!1,B()):(c.success(e.data.message),n.value.members=n.value.members.filter(V=>V!==a)):c.error(e.data.message)}).catch(e=>{console.error("Error kicking member:",e),c.error("踢出成员失败")})},te=()=>{v.value=1},oe=F(()=>!n.value||!n.value.members?[]:[n.value.creator,...n.value.members.filter(a=>a!==n.value.creator)]),ne=()=>{I.value=!0,b.value=n.value.description},le=async()=>{try{const a=await S.post("/admin_edit_group_info",{username:_.username,group_name:n.value.name,new_description:b.value},{headers:{"Content-Type":"application/x-www-form-urlencoded"}});a.data.code===200?(c.success("群组描述修改成功"),n.value.description=b.value,k.value=!1):c.error(a.data.message)}catch(a){console.error("Error updating group description:",a),c.error("更新群组描述失败")}},se=a=>{const e=new Date(a),V=e.getFullYear(),M=e.getMonth()+1,f=e.getDate(),i=e.getHours().toString().padStart(2,"0"),G=e.getMinutes().toString().padStart(2,"0"),U=e.getSeconds().toString().padStart(2,"0"),$=["日","一","二","三","四","五","六"][e.getDay()];return`${V}年${M}月${f}日 星期${$} ${i}:${G}:${U}`};return ie(()=>{B()}),(a,e)=>{const V=r("el-icon"),M=r("el-input"),f=r("el-table-column"),i=r("el-button"),G=r("el-table"),U=r("el-pagination"),L=r("el-card"),$=r("el-dialog"),re=r("el-tag"),ue=r("el-form-item"),ce=r("el-form");return g(),z("div",ge,[t(L,{class:"main-card"},{default:o(()=>[s("div",he,[t(M,{modelValue:E.value,"onUpdate:modelValue":e[0]||(e[0]=l=>E.value=l),placeholder:"搜索群组",onInput:te,clearable:""},{prefix:o(()=>[t(V,null,{default:o(()=>[t(me(ve))]),_:1})]),_:1},8,["modelValue"])]),s("div",we,[be,t(G,{data:j.value,style:{width:"100%"}},{default:o(()=>[t(f,{prop:"name",label:"群组名","min-width":"25%"}),t(f,{prop:"creator",label:"创建者","min-width":"25%"}),t(f,{label:"操作","min-width":"50%"},{default:o(l=>[t(i,{onClick:N=>J(l.row)},{default:o(()=>[u("详细信息")]),_:2},1032,["onClick"]),t(i,{onClick:N=>K(l.row)},{default:o(()=>[u("管理成员")]),_:2},1032,["onClick"]),t(i,{type:"danger",onClick:N=>W(l.row.name)},{default:o(()=>[u("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),t(U,{"current-page":v.value,"onUpdate:currentPage":e[1]||(e[1]=l=>v.value=l),"page-size":q,total:A.value.length,onCurrentChange:X,layout:"prev, pager, next",class:"pagination"},null,8,["current-page","total"])]),_:1}),t($,{modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=l=>k.value=l),title:"详细信息"},{default:o(()=>[s("p",null,[ye,u(x(n.value.name),1)]),s("p",null,[ke,u(x(n.value.creator),1)]),s("p",null,[Ce,u(x(se(n.value.create_time)),1)]),s("div",Ve,[s("p",null,[Me,I.value?(g(),T(M,{key:1,modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=l=>b.value=l),type:"textarea",rows:3},null,8,["modelValue"])):(g(),z("span",$e,x(n.value.description),1))]),I.value?(g(),T(i,{key:1,type:"primary",onClick:le,class:"save-button"},{default:o(()=>[u("保存")]),_:1})):(g(),T(i,{key:0,onClick:ne,class:"edit-button"},{default:o(()=>[u("编辑描述")]),_:1}))])]),_:1},8,["modelValue"]),t($,{modelValue:h.value,"onUpdate:modelValue":e[4]||(e[4]=l=>h.value=l),title:"成员管理"},{default:o(()=>[t(i,{onClick:Z,class:"add-member-button"},{default:o(()=>[u("新增成员")]),_:1}),t(G,{data:oe.value,style:{width:"100%"}},{default:o(()=>[t(f,{label:"用户名"},{default:o(l=>[u(x(l.row)+" ",1),l.row===n.value.creator?(g(),T(re,{key:0,size:"small",type:"info",effect:"light"},{default:o(()=>[u("群主")]),_:1})):pe("",!0)]),_:1}),t(f,{label:"操作",width:"120"},{default:o(l=>[t(i,{type:"danger",onClick:N=>ae(l.row)},{default:o(()=>[u("踢出")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"]),t($,{modelValue:w.value,"onUpdate:modelValue":e[6]||(e[6]=l=>w.value=l),title:"新增成员"},{footer:o(()=>[s("span",xe,[t(i,{onClick:P},{default:o(()=>[u("取消")]),_:1}),t(i,{type:"primary",onClick:ee},{default:o(()=>[u("确认")]),_:1})])]),default:o(()=>[t(ce,{model:p.value,rules:Y,ref_key:"addMemberForm",ref:C,"label-width":"80px"},{default:o(()=>[t(ue,{label:"用户名",prop:"username"},{default:o(()=>[t(M,{modelValue:p.value.username,"onUpdate:modelValue":e[5]||(e[5]=l=>p.value.username=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),De=Q(Se,[["__scopeId","data-v-b0cad75c"]]),Ee=m=>(H("data-v-c216ad74"),m=m(),O(),m),Ge={class:"common-layout"},Te=Ee(()=>s("i",{class:"el-icon-menu"},null,-1)),Ie=R({__name:"GroupManagement",setup(m){const _=d(!1),y=()=>{_.value=!_.value};return(v,k)=>{const h=r("el-button"),w=r("el-header"),n=r("el-main"),p=r("el-container");return g(),z("div",Ge,[t(p,null,{default:o(()=>[t(w,null,{default:o(()=>[t(h,{onClick:y,class:"menu-button"},{default:o(()=>[Te]),_:1})]),_:1}),t(p,{class:"main-container"},{default:o(()=>[s("div",{class:fe(["navigator-overlay",{active:_.value}])},[t(de,{username:v.$route.query.username},null,8,["username"])],2),t(p,{class:"content-container"},{default:o(()=>[t(n,null,{default:o(()=>[t(De,{username:v.$route.query.username},null,8,["username"])]),_:1})]),_:1})]),_:1})]),_:1})])}}}),Ne=Q(Ie,[["__scopeId","data-v-c216ad74"]]);export{Ne as default};
