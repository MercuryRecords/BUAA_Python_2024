import{d as fe,a as A,r as _,q as D,s as ye,b as r,o as u,c as g,f as o,w as a,e as S,t as he,h as c,F as C,x,y as h,n as ve,z as we,A as P,E as f,g as T,i as be,_ as ke}from"./index-BKtHripP.js";import{_ as Ce}from"./Navigator.vue_vue_type_script_setup_true_lang-Ce9qsQIy.js";const xe={class:"common-layout"},Te={class:"problem-list"},Ve={class:"el-dropdown-link"},ze={key:0,style:{"margin-top":"10px"}},qe={class:"pagination-container"},Se={class:"dialog-footer"},Pe=fe({__name:"QuestionBank",setup($e){const v=we(),l=A({keyword:"",tags:[],selectedTags:[]}),m=_([]),w=_(1),V=_(20),b=_(!1),$=_([]),B=_([]),N=_([]);async function Q(){try{const e=await P.post("/get_user_tags",{username:v.query.username},{headers:{"Content-Type":"application/x-www-form-urlencoded"}});e.data.code===200?(B.value=e.data.data.filter(t=>!["选择题","选择","填空题","填空"].includes(t)),N.value=[{name:"所有标签",tags:B.value},{name:"题目类型",tags:["选择题","填空题"]}],console.log("Get the tags",B.value)):f.error(e.data.message)}catch(e){console.error("Error fetching user tags:",e),f.error("获取标签失败")}}const I=D(()=>{const e=(w.value-1)*V.value,t=e+V.value;return $.value.slice(e,t)}),U=D(()=>$.value.length),y=()=>{$.value=m.value.filter(e=>{const t=l.keyword===""||e.problem_title.includes(l.keyword)||e.id===parseInt(l.keyword)||e.creator.includes(l.keyword)||e.problem_group_title.includes(l.keyword)||e.content.includes(l.keyword),s=l.selectedTags.length===0||l.selectedTags.every(k=>e.tags.includes(k));return t&&s}),w.value=1,f.success(`找到 ${U.value} 个匹配的题目`)},R=e=>{V.value=e,w.value=1},K=e=>{w.value=e},L=(e,t)=>{f.success(`准备解决题目: ${e.problem_title}`);const s=I.value,k=s.findIndex(i=>i.id===e.id);console.log(t),console.log(s),be.push({name:"solve",query:{username:v.query.username,index:k,problem_group_id:t}})},H=e=>{const t=I.value.map(s=>s.id);console.log(t),P.post("/temporary_problem_group_create",{username:v.query.username,problem_ids:t},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(s){s.data.code===200?(console.log("Ready to solve"),L(e,s.data.data)):f.error(s.data.message)}).catch(function(){console.log("error submit!")})},J=()=>{l.keyword="",l.tags=[],l.selectedTags=[],z(""),F.value="",y()},O=()=>{b.value=!0},W=()=>{b.value=!1,l.selectedTags=[...l.tags],y()},X=e=>{l.selectedTags=l.selectedTags.filter(t=>t!==e),l.tags=l.tags.filter(t=>t!==e),y()},Y=e=>e>=.7?"success":e<.3?"danger":"warning";function z(e){console.log(m.value),P.post("/get_problems",{username:v.query.username,filter_group:e},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){if(t.data.code===200){m.value=[];for(let s=0;s<t.data.data.length;s++)console.log(t.data.data[s]),m.value[s]=t.data.data[s],m.value[s].accuracy=t.data.data[s].all_count==0?0:t.data.data[s].all_right_count/t.data.data[s].all_count,console.log(m);y()}else console.log("Mission failed"),f.error(t.data.message),m.value=[],y()}).catch(function(){console.log("error submit!")})}const Z=async()=>{z("")},j=A([]),ee=async()=>{P.post("/group_get_groups",{username:v.query.username},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){if(e.data.code===200)for(let t=0;t<e.data.groups.length;t++)j.push(e.data.groups[t].name);else f.error(e.data.message)}).catch(function(){console.log("error submit!")})},F=_(""),te=e=>{F.value=e,z(e==="公开分享"?"_shared_to_all":e)};return ye(async()=>{await Q(),await Z(),await ee()}),(e,t)=>{const s=r("el-header"),k=r("el-aside"),i=r("el-button"),q=r("el-form-item"),oe=r("el-icon"),E=r("el-dropdown-item"),ae=r("el-dropdown-menu"),le=r("el-dropdown"),ne=r("el-input"),se=r("el-form"),G=r("el-tag"),re=r("el-card"),p=r("el-table-column"),ce=r("el-table"),ue=r("el-pagination"),de=r("el-main"),M=r("el-container"),ie=r("el-checkbox"),_e=r("el-checkbox-group"),me=r("el-tab-pane"),pe=r("el-tabs"),ge=r("el-dialog");return u(),g("div",xe,[o(M,null,{default:a(()=>[o(s),o(M,null,{default:a(()=>[o(k,{width:"200px"},{default:a(()=>[o(Ce,{username:e.$route.query.username},null,8,["username"])]),_:1}),o(M,null,{default:a(()=>[o(de,{class:"shifted-content"},{default:a(()=>[S("div",Te,[o(re,null,{default:a(()=>[o(se,{inline:!0,model:l,class:"demo-form-inline",onSubmit:t[1]||(t[1]=he(()=>{},["prevent"]))},{default:a(()=>[o(q,null,{default:a(()=>[o(i,{onClick:O},{default:a(()=>[c("选择标签")]),_:1})]),_:1}),o(le,{onCommand:te},{dropdown:a(()=>[o(ae,null,{default:a(()=>[o(E,{command:""},{default:a(()=>[c("我可见的所有")]),_:1}),o(E,{command:"公开分享"},{default:a(()=>[c("公开分享")]),_:1}),(u(!0),g(C,null,x(j,n=>(u(),T(E,{key:n,command:n},{default:a(()=>[c(h(n),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:a(()=>[S("span",Ve,[c(h(F.value||"选择群组")+" ",1),o(oe,{class:"el-icon--right"})])]),_:1}),o(q,null,{default:a(()=>[o(i,{type:"primary",onClick:J,style:{"margin-left":"20px"}},{default:a(()=>[c("清除所有筛选条件 ")]),_:1})]),_:1}),o(q,null,{default:a(()=>[o(ne,{modelValue:l.keyword,"onUpdate:modelValue":t[0]||(t[0]=n=>l.keyword=n),placeholder:"搜索关键词（题号、标题、上传者、所属题单）",style:{width:"310px","margin-left":"60px"}},null,8,["modelValue"])]),_:1}),o(q,null,{default:a(()=>[o(i,{onClick:y},{default:a(()=>[c("搜索")]),_:1})]),_:1})]),_:1},8,["model"]),l.selectedTags.length>0?(u(),g("div",ze,[(u(!0),g(C,null,x(l.selectedTags,n=>(u(),T(G,{key:n,closable:"",onClose:d=>X(n),style:{"margin-right":"5px"}},{default:a(()=>[c(h(n),1)]),_:2},1032,["onClose"]))),128))])):ve("",!0)]),_:1}),o(ce,{data:I.value,style:{width:"100%"}},{default:a(()=>[o(p,{prop:"id",label:"题号",width:"100"}),o(p,{prop:"problem_title",label:"题目名称"}),o(p,{prop:"creator",label:"上传者",width:"100"}),o(p,{prop:"problem_group_title",label:"所属题单",width:"180"}),o(p,{label:"标签",width:"200"},{default:a(n=>[(u(!0),g(C,null,x(n.row.tags,d=>(u(),T(G,{key:d,size:"small",style:{"margin-right":"5px"}},{default:a(()=>[c(h(d),1)]),_:2},1024))),128))]),_:1}),o(p,{prop:"accuracy",label:"正确率",width:"100"},{default:a(n=>[o(G,{type:Y(n.row.accuracy),size:"small"},{default:a(()=>[c(h((n.row.accuracy*100).toFixed(2))+"% ",1)]),_:2},1032,["type"])]),_:1}),o(p,{label:"操作",width:"100"},{default:a(n=>[o(i,{type:"text",size:"small",onClick:d=>H(n.row)},{default:a(()=>[c("解题")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),S("div",qe,[o(ue,{style:{"justify-content":"center"},class:"pagination",onSizeChange:R,onCurrentChange:K,"current-page":w.value,"page-sizes":[10,20,50,100],"page-size":V.value,layout:"total, sizes, jumper, ->, prev, pager, next",total:U.value},null,8,["current-page","page-size","total"])])])]),_:1})]),_:1})]),_:1})]),_:1}),o(ge,{modelValue:b.value,"onUpdate:modelValue":t[4]||(t[4]=n=>b.value=n),title:"选择标签",width:"50%"},{footer:a(()=>[S("span",Se,[o(i,{onClick:t[3]||(t[3]=n=>b.value=!1)},{default:a(()=>[c("取消")]),_:1}),o(i,{type:"primary",onClick:W},{default:a(()=>[c("确认")]),_:1})])]),default:a(()=>[o(pe,{type:"border-card"},{default:a(()=>[(u(!0),g(C,null,x(N.value,n=>(u(),T(me,{key:n.name,label:n.name},{default:a(()=>[o(_e,{modelValue:l.tags,"onUpdate:modelValue":t[2]||(t[2]=d=>l.tags=d)},{default:a(()=>[(u(!0),g(C,null,x(n.tags,d=>(u(),T(ie,{key:d,label:d},{default:a(()=>[c(h(d),1)]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1},8,["modelValue"])])}}}),Fe=ke(Pe,[["__scopeId","data-v-2af866df"]]);export{Fe as default};
