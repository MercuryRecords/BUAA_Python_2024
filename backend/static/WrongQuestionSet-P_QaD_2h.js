import{d as he,a as A,r as p,q as K,s as we,b as r,o as u,c as w,f as o,w as a,e as E,t as ye,h as c,F as T,x as V,y,S as ve,n as be,z as ke,A as $,E as v,g as S,i as Ce,_ as xe}from"./index-BKtHripP.js";import{_ as Te}from"./Navigator.vue_vue_type_script_setup_true_lang-Ce9qsQIy.js";const Ve={class:"common-layout"},Se={class:"problem-list"},ze={class:"el-dropdown-link"},$e={key:0,class:"selected-tags"},qe={class:"dialog-footer"},De=he({__name:"WrongQuestionSet",setup(Ie){const b=ke(),s=A({keyword:"",tags:[],selectedTags:[]}),m=p([]),k=p(1),z=p(20),C=p(!1),q=p([]),G=p([]);async function Q(){try{const e=await $.post("/get_user_tags",{username:b.query.username},{headers:{"Content-Type":"application/x-www-form-urlencoded"}});e.data.code===200?(q.value=e.data.data.filter(t=>!["选择题","选择","填空题","填空"].includes(t)),G.value=[{name:"所有标签",tags:q.value},{name:"题目类型",tags:["选择题","填空题"]}],console.log("Get the tags",q.value)):v.error(e.data.message)}catch(e){console.error("Error fetching user tags:",e),v.error("获取标签失败")}}const D=p([]),I=K(()=>{const e=(k.value-1)*z.value,t=e+z.value;return D.value.slice(e,t)}),N=K(()=>D.value.length),g=()=>{D.value=m.value.filter(e=>{const t=s.keyword===""||e.problem_title.includes(s.keyword)||e.id===parseInt(s.keyword)||e.creator.includes(s.keyword)||e.problem_group_title.includes(s.keyword)||e.content.includes(s.keyword),n=s.selectedTags.length===0||s.selectedTags.every(f=>e.tags.includes(f));return t&&n}),k.value=1,v.success(`找到 ${N.value} 个匹配的题目`)},R=e=>{z.value=e,k.value=1},W=e=>{k.value=e},L=(e,t)=>{v.success(`准备解决题目: ${e.problem_title}`);const n=I.value,f=n.findIndex(d=>d.id===e.id);console.log(t),console.log(n),Ce.push({name:"solve",query:{username:b.query.username,index:f,problem_group_id:t}})},H=e=>{const t=I.value.map(n=>n.id);console.log(t),$.post("/temporary_problem_group_create",{username:b.query.username,problem_ids:t},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(n){n.data.code===200?(console.log("Ready to solve"),L(e,n.data.data)):v.error(n.data.message)}).catch(function(){console.log("error submit!")})},J=()=>{s.keyword="",s.tags=[],s.selectedTags=[],g()},O=()=>{C.value=!0},X=()=>{C.value=!1,s.selectedTags=[...s.tags],g()},Y=e=>{s.selectedTags=s.selectedTags.filter(t=>t!==e),s.tags=s.tags.filter(t=>t!==e),g()},Z=e=>e>=.7?"success":e<.3?"danger":"warning";function M(e){console.log(m.value),$.post("/get_records",{username:b.query.username},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){if(t.data.code===200){m.value=[];for(let n=0;n<t.data.data.length;n++)console.log(t.data.data[n]),m.value[n]=t.data.data[n],m.value[n].accuracy=t.data.data[n].all_count==0?0:t.data.data[n].all_right_count/t.data.data[n].all_count,t.data.data[n].type=="b"?m.value[n].tags.push("填空题"):m.value[n].tags.push("选择题"),console.log(m);g()}else console.log("Mission failed"),v.error(t.data.message),m.value=[],g();console.log(t.data)}).catch(function(){console.log("error submit!")})}const ee=e=>{const t=new Date().getTime(),n=new Date(e).getTime(),f=Math.floor((t-n)/1e3),d=[{name:"year",seconds:60*60*24*365},{name:"month",seconds:60*60*24*30},{name:"day",seconds:60*60*24},{name:"hour",seconds:60*60},{name:"minute",seconds:60},{name:"second",seconds:1}];for(const h of d){const x=f/h.seconds;if(x>=1)return`${Math.floor(x)} ${h.name}${Math.floor(x)>1?"s":""} ago`}return"just now"},te=async()=>{M()},U=A([]),oe=async()=>{$.post("/group_get_groups",{username:b.query.username},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){if(e.data.code===200)for(let t=0;t<e.data.groups.length;t++)U.push(e.data.groups[t].name);else v.error(e.data.message)}).catch(function(){console.log("error submit!")})},j=p(""),ae=e=>{j.value=e,e!==""&&(e==="公开分享"||console.log(e,6666666666666666e14),M())};return we(async()=>{await Q(),await te(),await oe()}),(e,t)=>{const n=r("el-header"),f=r("el-aside"),d=r("el-button"),h=r("el-form-item"),x=r("el-icon"),P=r("el-dropdown-item"),ne=r("el-dropdown-menu"),le=r("el-dropdown"),se=r("el-input"),re=r("el-form"),F=r("el-tag"),ce=r("el-card"),_=r("el-table-column"),ue=r("el-table"),de=r("el-pagination"),ie=r("el-main"),B=r("el-container"),me=r("el-checkbox"),_e=r("el-checkbox-group"),pe=r("el-tab-pane"),ge=r("el-tabs"),fe=r("el-dialog");return u(),w("div",Ve,[o(B,null,{default:a(()=>[o(n),o(B,{class:"main-container"},{default:a(()=>[o(f,{width:"200px"},{default:a(()=>[o(Te,{username:e.$route.query.username},null,8,["username"])]),_:1}),o(B,{class:"content-container"},{default:a(()=>[o(ie,{class:"shifted-content"},{default:a(()=>[E("div",Se,[o(ce,null,{default:a(()=>[o(re,{inline:!0,model:s,class:"demo-form-inline",onSubmit:t[1]||(t[1]=ye(()=>{},["prevent"]))},{default:a(()=>[o(h,null,{default:a(()=>[o(d,{onClick:O},{default:a(()=>[c("选择标签")]),_:1})]),_:1}),o(le,{onCommand:ae},{dropdown:a(()=>[o(ne,null,{default:a(()=>[o(P,{command:""},{default:a(()=>[c("我可见的所有")]),_:1}),o(P,{command:"公开分享"},{default:a(()=>[c("公开分享")]),_:1}),(u(!0),w(T,null,V(U,l=>(u(),S(P,{key:l,command:l},{default:a(()=>[c(y(l),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:a(()=>[E("span",ze,[c(y(j.value||"选择群组")+" ",1),o(x,{class:"el-icon--right"})])]),_:1}),o(h,null,{default:a(()=>[o(d,{type:"primary",onClick:J,style:{"margin-left":"20px"}},{default:a(()=>[c("清除所有筛选条件 ")]),_:1})]),_:1}),o(h,null,{default:a(()=>[o(se,{modelValue:s.keyword,"onUpdate:modelValue":t[0]||(t[0]=l=>s.keyword=l),placeholder:"搜索关键词（题号、标题、上传者、所属题单）",style:{width:"310px","margin-left":"60px"},onKeyup:ve(g,["enter"])},null,8,["modelValue"])]),_:1}),o(h,null,{default:a(()=>[o(d,{onClick:g},{default:a(()=>[c("搜索")]),_:1})]),_:1})]),_:1},8,["model"]),s.selectedTags.length>0?(u(),w("div",$e,[(u(!0),w(T,null,V(s.selectedTags,l=>(u(),S(F,{key:l,closable:"",onClose:i=>Y(l),class:"tag"},{default:a(()=>[c(y(l),1)]),_:2},1032,["onClose"]))),128))])):be("",!0)]),_:1}),o(ue,{data:I.value,style:{width:"100%"},class:"problem-table"},{default:a(()=>[o(_,{label:"最近错误时间","min-width":"150"},{default:a(l=>[c(y(ee(l.row.last_error_time)),1)]),_:1}),o(_,{prop:"id",label:"题号","min-width":"80"}),o(_,{prop:"problem_title",label:"题目名称","min-width":"150"}),o(_,{prop:"creator",label:"上传者","min-width":"100"}),o(_,{prop:"problem_group_title",label:"所属题单","min-width":"150"}),o(_,{label:"标签","min-width":"150"},{default:a(l=>[(u(!0),w(T,null,V(l.row.tags,i=>(u(),S(F,{key:i,size:"small",class:"tag"},{default:a(()=>[c(y(i),1)]),_:2},1024))),128))]),_:1}),o(_,{prop:"accuracy",label:"正确率","min-width":"100"},{default:a(l=>[o(F,{type:Z(l.row.accuracy),size:"small"},{default:a(()=>[c(y((l.row.accuracy*100).toFixed(2))+"% ",1)]),_:2},1032,["type"])]),_:1}),o(_,{label:"操作","min-width":"80"},{default:a(l=>[o(d,{type:"text",size:"small",onClick:i=>H(l.row)},{default:a(()=>[c("解题")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),o(de,{class:"pagination",onSizeChange:R,onCurrentChange:W,"current-page":k.value,"page-sizes":[10,20,50,100],"page-size":z.value,layout:"total, sizes, jumper, ->, prev, pager, next",total:N.value},null,8,["current-page","page-size","total"])])]),_:1})]),_:1})]),_:1})]),_:1}),o(fe,{modelValue:C.value,"onUpdate:modelValue":t[4]||(t[4]=l=>C.value=l),title:"选择标签",width:"50%"},{footer:a(()=>[E("span",qe,[o(d,{onClick:t[3]||(t[3]=l=>C.value=!1)},{default:a(()=>[c("取消")]),_:1}),o(d,{type:"primary",onClick:X},{default:a(()=>[c("确认")]),_:1})])]),default:a(()=>[o(ge,{type:"border-card"},{default:a(()=>[(u(!0),w(T,null,V(G.value,l=>(u(),S(pe,{key:l.name,label:l.name},{default:a(()=>[o(_e,{modelValue:s.tags,"onUpdate:modelValue":t[2]||(t[2]=i=>s.tags=i)},{default:a(()=>[(u(!0),w(T,null,V(l.tags,i=>(u(),S(me,{key:i,label:i},{default:a(()=>[c(y(i),1)]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1},8,["modelValue"])])}}}),Fe=xe(De,[["__scopeId","data-v-23700c24"]]);export{Fe as default};
