import{_ as Z}from"./NavigatorM.vue_vue_type_script_setup_true_lang-vNEzk7W2.js";import{d as N,r,q as ee,s as ae,b as n,o as q,c as D,f as e,w as a,e as b,h as c,y,A as $,E as f,p as F,m as A,_ as E,R as te}from"./index-BKtHripP.js";const oe=l=>(F("data-v-2e353bf4"),l=l(),A(),l),se={class:"user-management"},ne={class:"table-header"},le=oe(()=>b("h2",null,"用户管理",-1)),re={class:"dialog-footer"},ue=N({__name:"Users",props:["username"],setup(l){const m=l,h=r([]),u=r(1),p=r(10),U=r(0),v=r(!1),_=r({}),d=r(!1),i=r({username:"",password:""}),g=r(),M={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},T=ee(()=>{const t=(u.value-1)*p.value,o=t+p.value;return h.value.slice(t,o)}),C=async()=>{try{const t=await $.post("/admin_get_user_list",{username:m.username},{headers:{"Content-Type":"application/x-www-form-urlencoded"}});t.data.code===200?(h.value=t.data.data,U.value=t.data.data.length):(console.error("Failed to fetch users:",t.data.message),f.error(t.data.message))}catch(t){console.error("Error fetching users:",t),f.error("获取用户列表失败")}},B=t=>{_.value=t,v.value=!0},P=async t=>{$.post("/admin_delete_user",{username:m.username,name:t},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(o){o.data.code===200?C():f.error(o.data.message)}).catch(function(){console.log("error submit!")})},j=t=>{p.value=t,u.value=1},O=t=>{u.value=t},R=()=>{d.value=!0},G=async()=>{g.value&&g.value.validate(t=>{t?$.post("/admin_register_user",{username:m.username,name:i.value.username,password:i.value.password},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(o){o.data.code===200?(C(),d.value=!1,k(),f.success("用户添加成功")):f.error(o.data.message)}).catch(function(){console.log("error submit!"),f.error("添加用户失败")}):console.log("error submit!")})},H=()=>{d.value=!1,k()},k=()=>{i.value={username:"",password:""},g.value&&g.value.resetFields()};return ae(()=>{C()}),(t,o)=>{const w=n("el-button"),V=n("el-table-column"),J=n("el-popconfirm"),K=n("el-table"),L=n("el-pagination"),Q=n("el-card"),x=n("el-descriptions-item"),W=n("el-descriptions"),z=n("el-dialog"),S=n("el-input"),I=n("el-form-item"),X=n("el-form");return q(),D("div",se,[e(Q,{class:"table-container"},{header:a(()=>[b("div",ne,[le,e(w,{type:"primary",onClick:R,class:"add-user-button"},{default:a(()=>[c(" 新增用户 ")]),_:1})])]),default:a(()=>[e(K,{data:T.value,style:{width:"100%"}},{default:a(()=>[e(V,{label:"序号",width:"80",align:"center"},{default:a(s=>[c(y((u.value-1)*p.value+s.$index+1),1)]),_:1}),e(V,{prop:"username",label:"用户名"}),e(V,{label:"操作",width:"240",align:"center"},{default:a(s=>[e(w,{onClick:Y=>B(s.row)},{default:a(()=>[c(" 详细信息 ")]),_:2},1032,["onClick"]),e(J,{title:"确定要删除该用户吗？",onConfirm:Y=>P(s.row.username)},{reference:a(()=>[e(w,{type:"danger"},{default:a(()=>[c(" 删除 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),e(L,{"current-page":u.value,"onUpdate:currentPage":o[0]||(o[0]=s=>u.value=s),"page-size":p.value,"onUpdate:pageSize":o[1]||(o[1]=s=>p.value=s),"page-sizes":[10,20,30,50],total:U.value,onSizeChange:j,onCurrentChange:O,layout:"total, sizes, jumper, ->, prev, pager, next",class:"pagination"},null,8,["current-page","page-size","total"])]),_:1}),e(z,{modelValue:v.value,"onUpdate:modelValue":o[2]||(o[2]=s=>v.value=s),title:"用户详细信息",width:"30%"},{default:a(()=>[e(W,{column:1,border:""},{default:a(()=>[e(x,{label:"用户名"},{default:a(()=>[c(y(_.value.username),1)]),_:1}),e(x,{label:"密码"},{default:a(()=>[c(y(_.value.password),1)]),_:1}),e(x,{label:"所属群组"},{default:a(()=>{var s;return[c(y(((s=_.value.groups)==null?void 0:s.join(", "))||"无"),1)]}),_:1})]),_:1})]),_:1},8,["modelValue"]),e(z,{modelValue:d.value,"onUpdate:modelValue":o[5]||(o[5]=s=>d.value=s),title:"新增用户",width:"30%"},{footer:a(()=>[b("span",re,[e(w,{onClick:H},{default:a(()=>[c("取消")]),_:1}),e(w,{type:"primary",onClick:G},{default:a(()=>[c("确认")]),_:1})])]),default:a(()=>[e(X,{model:i.value,rules:M,ref_key:"addUserForm",ref:g,"label-width":"80px"},{default:a(()=>[e(I,{label:"用户名",prop:"username"},{default:a(()=>[e(S,{modelValue:i.value.username,"onUpdate:modelValue":o[3]||(o[3]=s=>i.value.username=s)},null,8,["modelValue"])]),_:1}),e(I,{label:"密码",prop:"password"},{default:a(()=>[e(S,{modelValue:i.value.password,"onUpdate:modelValue":o[4]||(o[4]=s=>i.value.password=s),type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),de=E(ue,[["__scopeId","data-v-2e353bf4"]]),ce=l=>(F("data-v-19b96424"),l=l(),A(),l),ie={class:"common-layout"},me=ce(()=>b("i",{class:"el-icon-menu"},null,-1)),pe=N({__name:"UserManagement",setup(l){const m=r(!1),h=()=>{m.value=!m.value};return(u,p)=>{const U=n("el-button"),v=n("el-header"),_=n("el-main"),d=n("el-container");return q(),D("div",ie,[e(d,null,{default:a(()=>[e(v,null,{default:a(()=>[e(U,{onClick:h,class:"menu-button"},{default:a(()=>[me]),_:1})]),_:1}),e(d,{class:"main-container"},{default:a(()=>[b("div",{class:te(["navigator-overlay",{active:m.value}])},[e(Z,{username:u.$route.query.username},null,8,["username"])],2),e(d,{class:"content-container"},{default:a(()=>[e(_,null,{default:a(()=>[e(de,{username:u.$route.query.username},null,8,["username"])]),_:1})]),_:1})]),_:1})]),_:1})])}}}),ve=E(pe,[["__scopeId","data-v-19b96424"]]);export{ve as default};
